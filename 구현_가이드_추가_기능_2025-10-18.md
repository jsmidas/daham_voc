# êµ¬í˜„ ê°€ì´ë“œ - ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„ (2025-01-13)

> **ë‚ ì§œ**: 2025-01-13
> **êµ¬í˜„ ë²”ìœ„**: ì‹ìˆ˜ ê´€ë¦¬ ê°•í™”, ê·¼íƒœ íœ´ê²Œì‹œê°„ ê´€ë¦¬, ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
> **ê´€ë ¨ Phase**: Phase 3 (Backend), Phase 4 (Web), Phase 5 (Mobile)

---

## ğŸ“‹ ê°œìš”

### êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥
1. âœ… **ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • ì›¹ í˜ì´ì§€** (Phase 4)
   - ë‚ ì§œ ë²”ìœ„ ê¸°ë°˜ ì¡°íšŒ
   - ê°€ë¡œ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ (ë‚ ì§œ Ã— ì‹ì‚¬ ìœ í˜•)
   - ì¸ë¼ì¸ ìˆ˜ì •/ì‚­ì œ

2. âœ… **ê·¼íƒœ íœ´ê²Œì‹œê°„ ê´€ë¦¬** (Phase 3, 4, 5)
   - Backend API ì¶”ê°€
   - Web ê´€ë¦¬ì í˜ì´ì§€ ìˆ˜ì • ê¸°ëŠ¥
   - Mobile íœ´ê²Œì‹œê°„ ì…ë ¥ ê¸°ëŠ¥

3. âœ… **ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥** (Phase 4, 5)
   - ì‹ìˆ˜ í˜„í™© ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
   - ê·¼íƒœ í˜„í™© ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

4. âœ… **ëª¨ë°”ì¼ ì‹ìˆ˜ ê´€ë¦¬ í™”ë©´** (Phase 5)
   - ì‹ìˆ˜ ë“±ë¡ (ì¡°/ì¤‘/ì„/ì•¼)
   - ê°€ë¡œ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ
   - 30ì¼ ì´ë ¥ ì¡°íšŒ

---

## ğŸ—‚ï¸ íŒŒì¼ ë³€ê²½ ì‚¬í•­

### Phase 3 (Backend) - ê·¼íƒœ íœ´ê²Œì‹œê°„ ê´€ë¦¬

#### 1. ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •
```
backend/src/
â”œâ”€â”€ services/attendance.service.ts          [ìˆ˜ì •] updateAttendance í•¨ìˆ˜ ì¶”ê°€
â”œâ”€â”€ controllers/attendance.controller.ts    [ìˆ˜ì •] updateAttendance ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€
â””â”€â”€ routes/attendance.routes.ts             [ìˆ˜ì •] PUT /:id ë¼ìš°íŠ¸ ì¶”ê°€
```

**ë³€ê²½ ë‚´ìš©:**
- `breakStartTime`, `breakEndTime`, `note` í•„ë“œ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€
- ê´€ë¦¬ì ê¶Œí•œë§Œ ìˆ˜ì • ê°€ëŠ¥

---

### Phase 4 (Web Frontend) - ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • ë° ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

#### 1. ì‹ ê·œ íŒŒì¼ ìƒì„±
```
web/src/
â”œâ”€â”€ pages/meal-count/MealCountListPage.tsx  [ì‹ ê·œ] ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • í˜ì´ì§€
â””â”€â”€ router.tsx                              [ìˆ˜ì •] /meal-counts ë¼ìš°íŠ¸ ì¶”ê°€
```

#### 2. ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •
```
web/src/
â”œâ”€â”€ components/Layout/Sidebar.tsx           [ìˆ˜ì •] ì‹ìˆ˜ ë©”ë‰´ ë¶„ë¦¬
â”œâ”€â”€ pages/attendance/AttendanceListPage.tsx [ìˆ˜ì •] íœ´ê²Œì‹œê°„ ìˆ˜ì • ëª¨ë‹¬ ì¶”ê°€
â””â”€â”€ api/attendance.api.ts                   [ìˆ˜ì •] updateAttendance í•¨ìˆ˜ ì¶”ê°€
```

**ì£¼ìš” ê¸°ëŠ¥:**
- **ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • í˜ì´ì§€**:
  - ë‚ ì§œ ë²”ìœ„ ì„ íƒ (RangePicker, ê¸°ë³¸: í˜„ì¬ ì›”)
  - ê°€ë¡œ í…Œì´ë¸”: ë‚ ì§œ(í–‰) Ã— ì‹ì‚¬ìœ í˜•(ì—´)
  - ê° ì…€: ì¸ì›ìˆ˜, ë“±ë¡ì, ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼
  - ì¼ìë³„ í•©ê³„ í‘œì‹œ
  - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

- **ê·¼íƒœ ê´€ë¦¬ í˜ì´ì§€**:
  - íœ´ê²Œì‹œì‘/ì¢…ë£Œ ì‹œê°„ ì»¬ëŸ¼ ì¶”ê°€
  - TimePickerë¡œ ìˆ˜ì • ëª¨ë‹¬
  - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

---

### Phase 5 (Mobile App) - ì‹ìˆ˜ ë° ê·¼íƒœ ê¸°ëŠ¥ ê°•í™”

#### 1. ì‹ ê·œ íŒŒì¼ ìƒì„±
```
mobile/src/
â”œâ”€â”€ screens/MealCountScreen.tsx             [ì‹ ê·œ] ì‹ìˆ˜ ê´€ë¦¬ í™”ë©´
â”œâ”€â”€ api/meal-count.api.ts                   [ì‹ ê·œ] ì‹ìˆ˜ API í´ë¼ì´ì–¸íŠ¸
â””â”€â”€ navigation/MainNavigator.tsx            [ìˆ˜ì •] ì‹ìˆ˜ íƒ­ ì¶”ê°€
```

#### 2. ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •
```
mobile/src/
â”œâ”€â”€ screens/AttendanceScreen.tsx            [ìˆ˜ì •] íœ´ê²Œì‹œê°„ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€
â””â”€â”€ api/attendance.api.ts                   [ìˆ˜ì •] updateAttendance í•¨ìˆ˜ ì¶”ê°€
```

**ì£¼ìš” ê¸°ëŠ¥:**
- **ì‹ìˆ˜ ê´€ë¦¬ í™”ë©´**:
  - ì‚¬ì—…ì¥ ì„ íƒ
  - ë‚ ì§œ ì„ íƒ (ê¸°ë³¸: ì˜¤ëŠ˜)
  - ì¡°/ì¤‘/ì„/ì•¼ ì‹ì‚¬ ìœ í˜•ë³„ ì¸ì› ì…ë ¥
  - ê°€ë¡œ í…Œì´ë¸”ë¡œ ë“±ë¡ëœ ì‹ìˆ˜ í‘œì‹œ
  - 30ì¼ ì´ë ¥ ìŠ¤í¬ë¡¤ ì¡°íšŒ
  - ì‚­ì œ ê¸°ëŠ¥

- **ê·¼íƒœ ê´€ë¦¬ í™”ë©´**:
  - íœ´ê²Œì‹œê°„ í‘œì‹œ (ë¯¸ì…ë ¥ ì‹œ 'ë¯¸ì…ë ¥')
  - íœ´ê²Œì‹œê°„ ìˆ˜ì • ëª¨ë‹¬ (HH:MM í˜•ì‹)
  - ì‹œê°„ í˜•ì‹ ê²€ì¦

---

## ğŸ“ ìƒì„¸ êµ¬í˜„ ë‚´ìš©

### 1. ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • í˜ì´ì§€ (Web)

**íŒŒì¼**: `web/src/pages/meal-count/MealCountListPage.tsx`

**í•µì‹¬ ê¸°ëŠ¥**:
```typescript
// ë‚ ì§œ ë²”ìœ„ ìƒíƒœ
const [dateRange, setDateRange] = useState<[Dayjs, Dayjs]>([
  dayjs().startOf('month'),
  dayjs().endOf('month'),
]);

// ë‚ ì§œë³„ ë°ì´í„° ê·¸ë£¹í™”
const groupByDate = (data: MealCount[]) => {
  const grouped: { [date: string]: { [mealType: string]: MealCount } } = {};
  data.forEach((item) => {
    if (!grouped[item.date]) grouped[item.date] = {};
    grouped[item.date][item.mealType] = item;
  });
  return grouped;
};

// ë‚ ì§œ ë²”ìœ„ ë‚´ ëª¨ë“  ë‚ ì§œ ìƒì„±
const getAllDatesInRange = (startDate: Dayjs, endDate: Dayjs) => {
  const dates = [];
  let current = startDate.clone();
  while (current.isBefore(endDate) || current.isSame(endDate, 'day')) {
    dates.push(current.format('YYYY-MM-DD'));
    current = current.add(1, 'day');
  }
  return dates;
};

// ìš”ì¼ í•œê¸€ í‘œì‹œ
const getDayOfWeek = (date: string) => {
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  return days[dayjs(date).day()];
};
```

**í…Œì´ë¸” êµ¬ì¡°**:
- **ì»¬ëŸ¼**: ë‚ ì§œ | ì¡°ì‹ | ì¤‘ì‹ | ì„ì‹ | ì•¼ì‹ | í•©ê³„
- **ë‚ ì§œ ì»¬ëŸ¼**: MM/DD + ìš”ì¼(í•œê¸€)
- **ì‹ì‚¬ ì»¬ëŸ¼**: ì¸ì›ìˆ˜ + ë“±ë¡ìëª… + ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼
- **í•©ê³„ ì»¬ëŸ¼**: ì¼ìë³„ ì´ ì¸ì› ìˆ˜

**ì—‘ì…€ ë‹¤ìš´ë¡œë“œ**:
```typescript
const excelData = mealCounts.data.map((record: MealCount) => ({
  'ë‚ ì§œ': dayjs(record.date).format('YYYY-MM-DD'),
  'ì‹ì‚¬ ìœ í˜•': getMealTypeLabel(record.mealType),
  'ì¸ì›': record.count,
  'ë“±ë¡ì': record.submitter?.name || '-',
  'ë“±ë¡ì‹œê°„': dayjs(record.submittedAt).format('YYYY-MM-DD HH:mm'),
  'ìƒíƒœ': record.isLate ? 'ëŠ¦ì€ ì œì¶œ' : 'ì •ìƒ',
  'ë¹„ê³ ': record.note || '-',
}));
```

---

### 2. ê·¼íƒœ íœ´ê²Œì‹œê°„ ê´€ë¦¬

#### Backend (Phase 3)

**íŒŒì¼**: `backend/src/services/attendance.service.ts`

```typescript
export async function updateAttendance(
  id: string,
  data: {
    breakStartTime?: Date | null;
    breakEndTime?: Date | null;
    note?: string;
  }
): Promise<any> {
  const attendance = await prisma.attendance.findUnique({
    where: { id },
  });

  if (!attendance || attendance.deletedAt) {
    throw new Error('Attendance not found');
  }

  const updated = await prisma.attendance.update({
    where: { id },
    data: {
      breakStartTime: data.breakStartTime,
      breakEndTime: data.breakEndTime,
      note: data.note,
    },
    include: {
      user: { select: { id: true, name: true, email: true, role: true } },
      site: { select: { id: true, name: true, type: true } },
    },
  });

  await invalidateAttendanceCache(attendance.siteId);

  return updated;
}
```

**íŒŒì¼**: `backend/src/routes/attendance.routes.ts`

```typescript
// PUT /api/v1/attendances/:id - ì¶œí‡´ê·¼ ì •ë³´ ìˆ˜ì • (Admin only)
router.put(
  '/:id',
  authMiddleware,
  roleMiddleware(['SUPER_ADMIN', 'HQ_ADMIN', 'YEONGNAM_ADMIN']),
  attendanceController.updateAttendance
);
```

#### Web (Phase 4)

**íŒŒì¼**: `web/src/pages/attendance/AttendanceListPage.tsx`

**íœ´ê²Œì‹œê°„ ì»¬ëŸ¼ ì¶”ê°€**:
```typescript
{
  title: 'íœ´ê²Œì‹œì‘',
  dataIndex: 'breakStartTime',
  width: 120,
  render: (time?: string) => time ? dayjs(time).format('HH:mm') : '-',
},
{
  title: 'íœ´ê²Œì¢…ë£Œ',
  dataIndex: 'breakEndTime',
  width: 120,
  render: (time?: string) => time ? dayjs(time).format('HH:mm') : '-',
},
```

**ìˆ˜ì • ëª¨ë‹¬**:
```typescript
<Modal title="íœ´ê²Œì‹œê°„ ìˆ˜ì •" open={editModalVisible} onOk={handleSave}>
  <Form form={form} layout="vertical">
    <Form.Item label="íœ´ê²Œ ì‹œì‘ ì‹œê°„" name="breakStartTime">
      <TimePicker format="HH:mm" minuteStep={5} />
    </Form.Item>
    <Form.Item label="íœ´ê²Œ ì¢…ë£Œ ì‹œê°„" name="breakEndTime">
      <TimePicker format="HH:mm" minuteStep={5} />
    </Form.Item>
    <Form.Item label="ë¹„ê³ " name="note">
      <Input.TextArea rows={3} />
    </Form.Item>
  </Form>
</Modal>
```

**ì—‘ì…€ ë‹¤ìš´ë¡œë“œ**:
```typescript
const excelData = attendances.data.map((record: any) => ({
  'ì§ì›ëª…': record.user?.name || '-',
  'ì‚¬ì—…ì¥': record.site?.name || '-',
  'ì²´í¬ì¸': dayjs(record.checkInTime).format('YYYY-MM-DD HH:mm'),
  'ì²´í¬ì•„ì›ƒ': record.checkOutTime ? dayjs(record.checkOutTime).format('YYYY-MM-DD HH:mm') : 'ê·¼ë¬´ ì¤‘',
  'íœ´ê²Œì‹œì‘': record.breakStartTime ? dayjs(record.breakStartTime).format('HH:mm') : '-',
  'íœ´ê²Œì¢…ë£Œ': record.breakEndTime ? dayjs(record.breakEndTime).format('HH:mm') : '-',
  'ê·¼ë¬´ì‹œê°„': calculateWorkHours(record.checkInTime, record.checkOutTime),
  'ìƒíƒœ': getStatusText(record.status),
  'ë¹„ê³ ': record.note || '-',
}));
```

#### Mobile (Phase 5)

**íŒŒì¼**: `mobile/src/screens/AttendanceScreen.tsx`

**íœ´ê²Œì‹œê°„ í‘œì‹œ**:
```typescript
<View style={styles.timeRow}>
  <Text style={styles.timeLabel}>íœ´ê²Œ ì‹œê°„:</Text>
  <Text style={styles.timeValue}>
    {attendance.breakStartTime && attendance.breakEndTime
      ? `${formatTime(attendance.breakStartTime)} ~ ${formatTime(attendance.breakEndTime)}`
      : 'ë¯¸ì…ë ¥'}
  </Text>
</View>
```

**ìˆ˜ì • ëª¨ë‹¬**:
```typescript
<Modal visible={breakModalVisible} title="íœ´ê²Œì‹œê°„ ìˆ˜ì •">
  <TextInput
    placeholder="ì‹œì‘ ì‹œê°„ (HH:MM)"
    value={breakStartTime}
    onChangeText={setBreakStartTime}
    keyboardType="numeric"
  />
  <TextInput
    placeholder="ì¢…ë£Œ ì‹œê°„ (HH:MM)"
    value={breakEndTime}
    onChangeText={setBreakEndTime}
    keyboardType="numeric"
  />
  <Button onPress={handleBreakTimeUpdate}>ì €ì¥</Button>
</Modal>
```

---

### 3. ëª¨ë°”ì¼ ì‹ìˆ˜ ê´€ë¦¬ í™”ë©´

**íŒŒì¼**: `mobile/src/screens/MealCountScreen.tsx`

**í•µì‹¬ ê¸°ëŠ¥**:

1. **ì‹ìˆ˜ ë“±ë¡**:
```typescript
const handleSubmit = async () => {
  const counts = [
    { mealType: 'BREAKFAST', count: breakfast },
    { mealType: 'LUNCH', count: lunch },
    { mealType: 'DINNER', count: dinner },
    { mealType: 'SUPPER', count: supper },
  ];

  for (const item of counts) {
    if (item.count > 0) {
      await createMealCount({
        siteId: selectedSiteId,
        date: selectedDate,
        mealType: item.mealType,
        count: item.count,
      });
    }
  }
};
```

2. **ê°€ë¡œ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ**:
```typescript
{/* í…Œì´ë¸” í—¤ë” */}
<View style={styles.horizontalTableHeader}>
  {MEAL_TYPES.map((meal) => (
    <View key={meal.value} style={styles.horizontalHeaderCell}>
      <Text>{meal.icon}</Text>
      <Text>{meal.label}</Text>
    </View>
  ))}
</View>

{/* í…Œì´ë¸” ë°ì´í„° */}
<View style={styles.horizontalDataRow}>
  {MEAL_TYPES.map((meal) => {
    const data = mealMap[meal.value];
    return (
      <View key={meal.value} style={styles.horizontalDataCell}>
        {data ? (
          <>
            <Text>{data.count}ëª…</Text>
            {data.isLate && <Text>âš ï¸</Text>}
          </>
        ) : (
          <Text>-</Text>
        )}
      </View>
    );
  })}
</View>
```

3. **30ì¼ ì´ë ¥ ì¡°íšŒ**:
```typescript
const getLast30Days = () => {
  const dates = [];
  for (let i = 0; i < 30; i++) {
    dates.push(dayjs().subtract(i, 'day').format('YYYY-MM-DD'));
  }
  return dates;
};

const { data: mealCounts } = useQuery({
  queryKey: ['meal-counts', selectedSiteId, dateRange[0], dateRange[1]],
  queryFn: () => getMealCountsByRange(
    selectedSiteId,
    dateRange[0], // 30ì¼ ì „
    dateRange[1]  // ì˜¤ëŠ˜
  ),
});

// ë‚ ì§œë³„ ì„¹ì…˜ìœ¼ë¡œ í‘œì‹œ
{allDates.map((date) => (
  <View key={date}>
    <Text style={styles.dateHeader}>
      {dayjs(date).format('YYYY-MM-DD (ddd)')}
    </Text>
    {/* í•´ë‹¹ ë‚ ì§œì˜ ì‹ìˆ˜ ë°ì´í„° í…Œì´ë¸” */}
  </View>
))}
```

---

## ğŸ”§ npm íŒ¨í‚¤ì§€ ì„¤ì¹˜

### Web (xlsx ë¼ì´ë¸ŒëŸ¬ë¦¬)
```bash
cd web
npm install xlsx
```

---

## ğŸ“Š êµ¬í˜„ í†µê³„

### ì¶”ê°€/ìˆ˜ì •ëœ íŒŒì¼

| êµ¬ë¶„ | íŒŒì¼ ìˆ˜ | ì£¼ìš” íŒŒì¼ |
|------|---------|-----------|
| Backend (Phase 3) | 3ê°œ ìˆ˜ì • | attendance.service.ts, controller, routes |
| Web (Phase 4) | 1ê°œ ì‹ ê·œ, 4ê°œ ìˆ˜ì • | MealCountListPage (ì‹ ê·œ), Attendance í˜ì´ì§€, API |
| Mobile (Phase 5) | 2ê°œ ì‹ ê·œ, 2ê°œ ìˆ˜ì • | MealCountScreen (ì‹ ê·œ), meal-count.api (ì‹ ê·œ) |
| **ì´ê³„** | **3ê°œ ì‹ ê·œ, 9ê°œ ìˆ˜ì •** | **ì´ 12ê°œ íŒŒì¼** |

### ì¶”ê°€ ì½”ë“œ ë¼ì¸
- **Backend**: ~100 ë¼ì¸
- **Web**: ~600 ë¼ì¸
- **Mobile**: ~800 ë¼ì¸
- **ì´ê³„**: ~1,500 ë¼ì¸

---

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Web ì‹ìˆ˜ ì¡°íšŒ/ìˆ˜ì • í˜ì´ì§€
- [x] ì‚¬ì—…ì¥ ì„ íƒ ì‹œ ë°ì´í„° ì¡°íšŒ
- [x] ë‚ ì§œ ë²”ìœ„ ë³€ê²½ ì‹œ ë°ì´í„° ì¬ì¡°íšŒ
- [x] ê°€ë¡œ í…Œì´ë¸”ì— ë‚ ì§œë³„ ì‹ìˆ˜ í‘œì‹œ
- [x] ê° ì…€ì— ì¸ì›ìˆ˜, ë“±ë¡ìëª…, ë²„íŠ¼ í‘œì‹œ
- [x] ì‹ìˆ˜ ìˆ˜ì • ê¸°ëŠ¥
- [x] ì‹ìˆ˜ ì‚­ì œ ê¸°ëŠ¥
- [x] ì‹ìˆ˜ ë“±ë¡ ì‹œ ë‚ ì§œ ì„ íƒ ê°€ëŠ¥
- [x] ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
- [x] ìš”ì¼ í•œê¸€ í‘œì‹œ (ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼)

### Web ê·¼íƒœ ê´€ë¦¬ í˜ì´ì§€
- [x] íœ´ê²Œì‹œì‘/ì¢…ë£Œ ì»¬ëŸ¼ í‘œì‹œ
- [x] ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì˜¤í”ˆ
- [x] TimePickerë¡œ ì‹œê°„ ì„ íƒ
- [x] ì €ì¥ í›„ ë°ì´í„° ê°±ì‹ 
- [x] ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— íœ´ê²Œì‹œê°„ í¬í•¨

### Mobile ì‹ìˆ˜ ê´€ë¦¬ í™”ë©´
- [x] ì‚¬ì—…ì¥ ì„ íƒ
- [x] ë‚ ì§œ ì„ íƒ
- [x] ì¡°/ì¤‘/ì„/ì•¼ ì¸ì› ì…ë ¥
- [x] ë“±ë¡ ë²„íŠ¼ìœ¼ë¡œ ì €ì¥
- [x] ê°€ë¡œ í…Œì´ë¸”ë¡œ ë“±ë¡ëœ ì‹ìˆ˜ í‘œì‹œ
- [x] 30ì¼ ì´ë ¥ ìŠ¤í¬ë¡¤ ì¡°íšŒ
- [x] ì‚­ì œ ê¸°ëŠ¥

### Mobile ê·¼íƒœ ê´€ë¦¬ í™”ë©´
- [x] íœ´ê²Œì‹œê°„ í‘œì‹œ
- [x] ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì˜¤í”ˆ
- [x] HH:MM í˜•ì‹ìœ¼ë¡œ ì…ë ¥
- [x] í˜•ì‹ ê²€ì¦
- [x] ì €ì¥ í›„ ë°ì´í„° ê°±ì‹ 

---

## ğŸ¯ í–¥í›„ ê°œì„  ì‚¬í•­

### ì„±ëŠ¥ ìµœì í™”
- [ ] ì‹ìˆ˜ í…Œì´ë¸” ê°€ìƒ ìŠ¤í¬ë¡¤ ì ìš© (ëŒ€ëŸ‰ ë°ì´í„° ì‹œ)
- [ ] ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì›Œì»¤ ìŠ¤ë ˆë“œ ì‚¬ìš© (ëŒ€ìš©ëŸ‰ íŒŒì¼)

### ê¸°ëŠ¥ ì¶”ê°€
- [ ] ì‹ìˆ˜ ì¼ê´„ ë“±ë¡ (ì—¬ëŸ¬ ë‚ ì§œ ë™ì‹œ ë“±ë¡)
- [ ] ì‹ìˆ˜ ë³µì‚¬ ê¸°ëŠ¥ (ì´ì „ ë‚ ì§œ ë°ì´í„° ë³µì‚¬)
- [ ] ê·¼íƒœ ì¼ê´„ ìˆ˜ì • (ì—¬ëŸ¬ ì§ì› ë™ì‹œ ìˆ˜ì •)

### UX ê°œì„ 
- [ ] ì‹ìˆ˜ í…Œì´ë¸” í—¤ë” ê³ ì • (ìŠ¤í¬ë¡¤ ì‹œ)
- [ ] ëª¨ë°”ì¼ ì‹ìˆ˜ ë“±ë¡ ì‹œ ë§ˆì§€ë§‰ ì…ë ¥ ê°’ ìë™ ì±„ìš°ê¸°
- [ ] ê·¼íƒœ íœ´ê²Œì‹œê°„ ìë™ ê³„ì‚° (ì ì‹¬ì‹œê°„ ë“±)

---

## ğŸ“… êµ¬í˜„ ì™„ë£Œì¼
**2025-01-13**

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ
- [êµ¬í˜„_ê°€ì´ë“œ_Phase3.md](./êµ¬í˜„_ê°€ì´ë“œ_Phase3.md) - Backend ê·¼íƒœ ê´€ë¦¬
- [êµ¬í˜„_ê°€ì´ë“œ_Phase4.md](./êµ¬í˜„_ê°€ì´ë“œ_Phase4.md) - Web Frontend
- [êµ¬í˜„_ê°€ì´ë“œ_Phase5.md](./êµ¬í˜„_ê°€ì´ë“œ_Phase5.md) - Mobile App

======================================================================
======================================================================

â—  ğŸ¯ ë‹¤ìŒ ì‘ì—… ìš°ì„ ìˆœìœ„

  âœ… ì˜¤ëŠ˜ ì™„ë£Œí•œ ì‘ì—…

  1. GCP Storage ì—°ë™ - ì´ë¯¸ì§€ê°€ ì‹¤ì œ í´ë¼ìš°ë“œì—
  ì €ì¥ë¨
  2. Redis ìºì‹± êµ¬í˜„ - ëŒ€ì‹œë³´ë“œ ì„±ëŠ¥ ìµœì í™” ì¤€ë¹„ ì™„ë£Œ    

  ---
  ğŸ“± ë†’ìŒ ìš°ì„ ìˆœìœ„: ëª¨ë°”ì¼ ì•± í•µì‹¬ ê¸°ëŠ¥

  1. ë°°ì‹ì‚¬ì§„ ê´€ë¦¬ (1-2ì¼ ì†Œìš”)

  - ì¹´ë©”ë¼ë¡œ ì‚¬ì§„ ì´¬ì˜ (expo-camera)
  - ë°°ì‹/ì”ë°˜/ì‹œì„¤ ì‚¬ì§„ ì—…ë¡œë“œ
  - GPS ì¢Œí‘œ ê¸°ë¡ ë° Geofencing
  - ì‚¬ì§„ ëª©ë¡ ì¡°íšŒ ë° ì‚­ì œ
  ì¶”ì²œ ì´ìœ : ì‹¤ì œ ì‚¬ìš©ìê°€ ê°€ì¥ í•„ìš”ë¡œ í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥    

  2. ì‹ë‹¨ ì¡°íšŒ ê¸°ëŠ¥ (1ì¼ ì†Œìš”)

  - ì‚¬ì—…ì¥ë³„ ì£¼ê°„ ì‹ë‹¨í‘œ ì¡°íšŒ
  - ì´ë¯¸ì§€ ë·°ì–´
  - ë‚ ì§œë³„ í•„í„°ë§
  ì¶”ì²œ ì´ìœ : Backend API ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆì–´ ë¹ ë¥¸ êµ¬í˜„    
   ê°€ëŠ¥

  3. VOC ê¸°ëŠ¥ ë³´ì™„ (1ì¼ ì†Œìš”)

  - ì´ë¯¸ì§€ ì²¨ë¶€ (ìµœëŒ€ 6ê°œ)
  - ë‚´ VOC ëª©ë¡ ì¡°íšŒ
  - ë‹µë³€ ì•Œë¦¼

  ---
  ğŸŒ ì¤‘ê°„ ìš°ì„ ìˆœìœ„: ì›¹ ê´€ë¦¬ì ê¸°ëŠ¥ ê°•í™”

  1. ëŒ€ì‹œë³´ë“œ ê³ ë„í™” (2-3ì¼ ì†Œìš”)

  âœ… ê¸°ë³¸ í†µê³„ - ì´ë¯¸ êµ¬í˜„ë¨!
  âœ… íŠ¸ë Œë“œ ê·¸ë˜í”„ - Chart.js ì„¤ì¹˜ë¨!
  â³ ì‚¬ì—…ì¥ë³„ ìƒì„¸ í†µê³„
  â³ ë‹´ë‹¹ìë³„ í‰ì  í†µê³„
  ì¶”ì²œ ì´ìœ : ì˜¤ëŠ˜ Chart.js ì„¤ì¹˜ & ê¸°ë³¸ ê·¸ë˜í”„ ì™„ë£Œ,      
  ì¶”ê°€ ì‘ì—…ë§Œ í•˜ë©´ ë¨

  2. ë°°ì‹ì‚¬ì§„ ê´€ë¦¬ ê°œì„  (1-2ì¼ ì†Œìš”)

  - ì¼ê´„ ìŠ¹ì¸/ë°˜ë ¤ ê¸°ëŠ¥
  - ì‚¬ì§„ í•„í„°ë§ ê°•í™”
  - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ

  3. ì•Œë¦¼ ì‹œìŠ¤í…œ (2ì¼ ì†Œìš”)

  - ëŠ¦ì€ ì‹ìˆ˜ ì œì¶œ ì•Œë¦¼
  - VOC ë¯¸ì²˜ë¦¬ ì•Œë¦¼
  - ë¹„ì •ìƒ ê·¼íƒœ ì•Œë¦¼

  ---
  ğŸš€ ì¥ê¸° ìš°ì„ ìˆœìœ„: ì¸í”„ë¼ & ë°°í¬ (Phase 6)

  1. Docker ì»¨í…Œì´ë„ˆí™” (2-3ì¼ ì†Œìš”)

  - Backend Dockerfile
  - Web Dockerfile
  - docker-compose.yml (PostgreSQL, Redis, Backend,      
  Web)

  2. í´ë¼ìš°ë“œ ë°°í¬ (2-3ì¼ ì†Œìš”)

  âœ… GCP Storage - ì˜¤ëŠ˜ ì™„ë£Œ!
  â³ GCP Cloud Run ë°°í¬
  â³ PostgreSQL Cloud SQL
  â³ Redis Memorystore

  3. CI/CD íŒŒì´í”„ë¼ì¸ (1-2ì¼ ì†Œìš”)

  - GitHub Actions ì„¤ì •
  - ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  - ìë™ ë°°í¬

  ---
  ğŸ’¡ ì¶”ì²œí•˜ëŠ” ë‹¤ìŒ ì‘ì—… ìˆœì„œ

  ğŸ¥‡ 1ìˆœìœ„: ì›¹ ëŒ€ì‹œë³´ë“œ ê³ ë„í™” (2-3ì¼)

  ì´ìœ :
  - âœ… Chart.js ì´ë¯¸ ì„¤ì¹˜ë¨
  - âœ… ê¸°ë³¸ í†µê³„ ì´ë¯¸ í‘œì‹œ ì¤‘
  - âœ… Redis ìºì‹± ì¤€ë¹„ ì™„ë£Œ
  - ğŸ¯ ê´€ë¦¬ìê°€ ì¦‰ì‹œ í™œìš© ê°€ëŠ¥

  ì‘ì—… ë‚´ìš©:
  1. ì‚¬ì—…ì¥ë³„ ìƒì„¸ í†µê³„ ì°¨íŠ¸ ì¶”ê°€
  2. ë‹´ë‹¹ìë³„ í‰ì  í†µê³„ ì‹œê°í™”
  3. ì›”ê°„/ì£¼ê°„ íŠ¸ë Œë“œ ê·¸ë˜í”„ ì¶”ê°€
  4. ì‹¤ì‹œê°„ ë°ì´í„° ê°±ì‹  (Redis ìºì‹œ í™œìš©)

  ---
  ğŸ¥ˆ 2ìˆœìœ„: ëª¨ë°”ì¼ ë°°ì‹ì‚¬ì§„ ê´€ë¦¬ (1-2ì¼)

  ì´ìœ :
  - âœ… Backend API ì´ë¯¸ êµ¬í˜„ë¨
  - âœ… GCP Storage ì—°ë™ ì™„ë£Œ
  - ğŸ¯ í˜„ì¥ ì§ì›ë“¤ì´ ë§¤ì¼ ì‚¬ìš©í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥

  ì‘ì—… ë‚´ìš©:
  1. expo-cameraë¡œ ì‚¬ì§„ ì´¬ì˜
  2. GPS ìœ„ì¹˜ ê¸°ë¡
  3. ë°°ì‹/ì”ë°˜/ì‹œì„¤ íƒ€ì… ì„ íƒ
  4. ì—…ë¡œë“œ ë° ëª©ë¡ ì¡°íšŒ

  ---
  ğŸ¥‰ 3ìˆœìœ„: Docker & ë°°í¬ ì¤€ë¹„ (3-5ì¼)

  ì´ìœ :
  - ğŸ¯ í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬ í•„ìš”
  - âœ… GCP Storage ì´ë¯¸ ì„¤ì •ë¨
  - ì•ˆì •ì ì¸ ìš´ì˜ í™˜ê²½ êµ¬ì¶•

  ---
  ğŸ¤” ì–´ë–¤ ì‘ì—…ì„ ë¨¼ì € ì§„í–‰í• ê¹Œìš”?

  ì œê°€ ì¶”ì²œí•˜ëŠ” ìˆœì„œëŠ”:

  1. ì›¹ ëŒ€ì‹œë³´ë“œ ê³ ë„í™” â†’ ê´€ë¦¬ì í¸ì˜ì„± ê·¹ëŒ€í™”
  2. ëª¨ë°”ì¼ ë°°ì‹ì‚¬ì§„ â†’ í˜„ì¥ ì§ì› ì‹¤ì‚¬ìš©
  3. Docker & ë°°í¬ â†’ í”„ë¡œë•ì…˜ ì¤€ë¹„

======================================================================
======================================================================

# ğŸ—“ï¸ ì‘ì—… ì¼ì§€ - 2025-10-18

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ëª¨ë°”ì¼ ì•± UI ê°œì„ 
- **ë„¤ë¹„ê²Œì´ì…˜ë°” ìœ„ì¹˜ ë³€ê²½**: í•˜ë‹¨ â†’ ìƒë‹¨ íƒ­ìœ¼ë¡œ ì´ë™
  - `@react-navigation/material-top-tabs` ì„¤ì¹˜
  - `AppNavigator.tsx` ìˆ˜ì •
  - ì´ìœ : í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ì´ í° ë²„íŠ¼ê³¼ ê²¹ì¹˜ëŠ” ë¬¸ì œ í•´ê²°

### 2. ì‚¬ì—…ì¥ ì„ íƒ ë¡œì§ ê°œì„ 
- **ë¡œê·¸ì¸ í›„ ìë™ ì‚¬ì—…ì¥ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€**
  - `SiteSelector.tsx` ìˆ˜ì •
  - ë³µìˆ˜ ì‚¬ì—…ì¥: ëª¨ë‹¬ ìë™ í‘œì‹œ
  - ë‹¨ì¼ ì‚¬ì—…ì¥: ìë™ ì„ íƒ
  - `hasShownModal` ìƒíƒœë¡œ ì¤‘ë³µ ëª¨ë‹¬ ë°©ì§€

### 3. ë„ë©”ì¸ ë° HTTPS ì„¤ì • (ì™„ë£Œ)
- **ë„ë©”ì¸ êµ¬ë§¤**: `dahamvoc.co.kr` (ì¹´í˜24)
- **DNS ì„¤ì •**:
  - A ë ˆì½”ë“œ: @ â†’ 34.50.60.199
  - A ë ˆì½”ë“œ: www â†’ 34.50.60.199
  - A ë ˆì½”ë“œ: api â†’ 34.50.60.199
- **Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •**:
  - api.dahamvoc.co.kr â†’ localhost:3000 (Backend API)
  - dahamvoc.co.kr, www.dahamvoc.co.kr â†’ localhost:5173 (Web Admin)
- **SSL ì¸ì¦ì„œ ì„¤ì¹˜**: Let's Encrypt
  - ëª¨ë“  ë„ë©”ì¸ì— HTTPS ì ìš© ì™„ë£Œ
  - ìë™ ê°±ì‹  ì„¤ì •ë¨

### 4. ëª¨ë°”ì¼ ì•± HTTPS ì—…ë°ì´íŠ¸
- **EAS ë¹Œë“œ ì„¤ì • ë³€ê²½**:
  - `mobile/eas.json`: API URLì„ `https://api.dahamvoc.co.kr/api/v1`ë¡œ ë³€ê²½
  - `mobile/app.json`: `usesCleartextTraffic: false`ë¡œ ë³€ê²½
- **ìƒˆ APK ë¹Œë“œ ì™„ë£Œ**:
  - Build ID: dfc68627-fc1a-4424-8222-0d1de00694dc
  - HTTPSë¡œ ì•ˆì „í•œ í†µì‹  ê°€ëŠ¥

### 5. ì›¹ ê´€ë¦¬ì ì„¤ì • ë³€ê²½
- **Vite proxy ì„¤ì •**:
  - `web/vite.config.ts`: proxy targetì„ `https://api.dahamvoc.co.kr`ë¡œ ë³€ê²½
  - `web/.env`: API_BASE_URLì„ `/api/v1`ë¡œ ë³€ê²½ (proxy ì‚¬ìš©)
  - CORS ë¬¸ì œ í•´ê²°

### 6. Git ì»¤ë°‹ ë° í‘¸ì‹œ
- ì»¤ë°‹ ë©”ì‹œì§€: "chore: ì›¹ ê´€ë¦¬ì Vite proxy ì„¤ì •ì„ HTTPS APIë¡œ ì—…ë°ì´íŠ¸ ë° ëª¨ë°”ì¼ ì„œë¸Œëª¨ë“ˆ ì—…ë°ì´íŠ¸"
- GitHub í‘¸ì‹œ ì™„ë£Œ

---

## âš ï¸ ë¯¸ì™„ë£Œ ì‘ì—… (ë‹¤ìŒ ì„¸ì…˜ì— ì§„í–‰)

### 1. GCP VM ë°±ì—”ë“œ ì—…ë°ì´íŠ¸ (ì¤‘ìš”!)
**ë¬¸ì œ**: ëŒ€ì‹œë³´ë“œ API 404 ì—ëŸ¬ ë°œìƒ
**ì›ì¸**: GCP VMì˜ ë°±ì—”ë“œê°€ ìµœì‹  ì½”ë“œë¡œ ë¹Œë“œë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
```bash
# GCP VM SSH ì ‘ì† í›„ ì‹¤í–‰
cd ~/daham_voc/backend

# TypeScript ë¹Œë“œ
npm run build

# í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ë°±ì—”ë“œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
pkill -f "node.*server.js"

# ë°±ì—”ë“œ ì¬ì‹œì‘
nohup npm start > nohup.out 2>&1 &

# í™•ì¸
sleep 5
curl http://localhost:3000/health
tail -20 nohup.out
```

### 2. ëŒ€ì‹œë³´ë“œ API í™•ì¸
- `GET /api/v1/dashboard/daily-voc-trend` - 404 ì—ëŸ¬
- `GET /api/v1/dashboard/site-comparison` - 404 ì—ëŸ¬
- `GET /api/v1/dashboard/staff-performance` - 404 ì—ëŸ¬

ìœ„ APIë“¤ì€ ë¡œì»¬ ì½”ë“œì—ëŠ” êµ¬í˜„ë˜ì–´ ìˆìœ¼ë‚˜, GCP VMì˜ dist í´ë”ì— ë¹Œë“œë˜ì§€ ì•Šì€ ìƒíƒœ

### 3. ëª¨ë°”ì¼ ì•± í…ŒìŠ¤íŠ¸
- ìµœì‹  APK ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜ í…ŒìŠ¤íŠ¸
- HTTPS API ì—°ê²° í™•ì¸
- ì‚¬ì—…ì¥ ì„ íƒ ë¡œì§ í™•ì¸
- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ë°” ë™ì‘ í™•ì¸

### 4. PM2 ì„¤ì • (ì„ íƒì‚¬í•­)
- í˜„ì¬ nohupìœ¼ë¡œ ì‹¤í–‰ ì¤‘
- PM2ë¡œ ë³€ê²½í•˜ë©´ ìë™ ì¬ì‹œì‘, ë¡œê·¸ ê´€ë¦¬ ë“± í¸ë¦¬
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” PM2 ê¶Œì¥

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### GCP VM í˜„ì¬ ìƒíƒœ
- **IP**: 34.50.60.199
- **ë„ë©”ì¸**: dahamvoc.co.kr, www.dahamvoc.co.kr, api.dahamvoc.co.kr
- **SSL**: Let's Encrypt (ìë™ ê°±ì‹ )
- **Nginx**: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì • ì™„ë£Œ
- **ë°±ì—”ë“œ**: nohupìœ¼ë¡œ ì‹¤í–‰ ì¤‘ (í¬íŠ¸ 3000)
- **ì›¹ í”„ë¡ íŠ¸ì—”ë“œ**: PM2ë¡œ ê´€ë¦¬ (daham-frontend)

### ë¡œì»¬ ê°œë°œ í™˜ê²½
- **ì›¹ ì„œë²„**: http://localhost:5175
- **ë°±ì—”ë“œ API**: Vite proxyë¥¼ í†µí•´ https://api.dahamvoc.co.krë¡œ ì—°ê²°

---

## ğŸ¯ ë‹¤ìŒ ì‘ì—… ìš°ì„ ìˆœìœ„

1. **ê¸´ê¸‰**: GCP VM ë°±ì—”ë“œ ë¹Œë“œ ë° ì¬ì‹œì‘ (5ë¶„ ì†Œìš”)
2. **ì¤‘ìš”**: ëŒ€ì‹œë³´ë“œ API ì •ìƒ ì‘ë™ í™•ì¸
3. **ì¤‘ìš”**: ëª¨ë°”ì¼ ì•± ìµœì‹  ë¹Œë“œ í…ŒìŠ¤íŠ¸
4. **ì„ íƒ**: PM2ë¡œ ë°±ì—”ë“œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ ë³€ê²½

---

**ì‘ì—… ì™„ë£Œì¼**: 2025-10-18
**ë‹¤ìŒ ì‘ì—… ì˜ˆì •ì¼**: ë‹¤ìŒ ì„¸ì…˜