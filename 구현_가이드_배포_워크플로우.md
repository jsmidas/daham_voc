# Daham VOC - ë°°í¬ ë° ê°œë°œ ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ

> **ğŸ“Œ ëª©ì **: ë¡œì»¬ ê°œë°œë¶€í„° í”„ë¡œë•ì…˜ ë°°í¬ê¹Œì§€ì˜ ì „ì²´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨
1. [ê°œë°œ í™˜ê²½ êµ¬ì¡°](#1-ê°œë°œ-í™˜ê²½-êµ¬ì¡°)
2. [ë¡œì»¬ vs í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •](#2-ë¡œì»¬-vs-í”„ë¡œë•ì…˜-í™˜ê²½-ì„¤ì •)
3. [ê°œë°œ ì›Œí¬í”Œë¡œìš°](#3-ê°œë°œ-ì›Œí¬í”Œë¡œìš°)
4. [í”„ë¡œë•ì…˜ ë°°í¬ í”„ë¡œì„¸ìŠ¤](#4-í”„ë¡œë•ì…˜-ë°°í¬-í”„ë¡œì„¸ìŠ¤)
5. [ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬](#5-ë°ì´í„°ë² ì´ìŠ¤-ê´€ë¦¬)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#6-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## 1. ê°œë°œ í™˜ê²½ êµ¬ì¡°

### 1.1 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  ë¡œì»¬ ê°œë°œ í™˜ê²½ (ê°œë°œì PC)                              â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Web (5173)   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ Backend(3000)â”‚                â”‚
â”‚  â”‚ Vite Dev     â”‚       â”‚  Nodemon     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                 â”‚                         â”‚
â”‚                                 â–¼                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                         â”‚ PostgreSQL   â”‚                 â”‚
â”‚                         â”‚ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)â”‚                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                           â”‚
â”‚  ìš©ë„: ìƒˆ ê¸°ëŠ¥ ê°œë°œ, ë²„ê·¸ ìˆ˜ì •, í…ŒìŠ¤íŠ¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              Git Push
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜ï¸  í”„ë¡œë•ì…˜ ì„œë²„ (GCP VM - 165.246.44.4)                  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Nginx (80)   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ Backend(3000)â”‚                â”‚
â”‚  â”‚ HTTPS (443)  â”‚       â”‚  PM2         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                 â”‚                         â”‚
â”‚                                 â–¼                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                         â”‚ PostgreSQL   â”‚                 â”‚
â”‚                         â”‚ (ì‹¤ì œ ë°ì´í„°) â”‚                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                           â”‚
â”‚  ìš©ë„: ì‹¤ì œ ì„œë¹„ìŠ¤, ì‹¤ì œ ë°ì´í„° ì…ë ¥/ê´€ë¦¬                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í™˜ê²½ë³„ URL

| í™˜ê²½ | ì›¹ ê´€ë¦¬ì | ë°±ì—”ë“œ API |
|------|-----------|-----------|
| **ë¡œì»¬** | http://localhost:5173 | http://localhost:3000/api/v1 |
| **í”„ë¡œë•ì…˜** | https://dahamvoc.co.kr | https://api.dahamvoc.co.kr/api/v1 |

---

## 2. ë¡œì»¬ vs í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •

### 2.1 ë°±ì—”ë“œ í™˜ê²½ ë³€ìˆ˜

#### ë¡œì»¬ ê°œë°œ í™˜ê²½ (backend/.env)

```env
# Environment
NODE_ENV=development
PORT=3000

# Database (ë¡œì»¬ PostgreSQL)
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/daham_voc
MONGODB_URI=mongodb://localhost:27017/daham_voc
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET=daham_voc_secret_key_2025_development_only
JWT_EXPIRES_IN=7d

# GCP Storage
GCP_PROJECT_ID=your-project-id
GCP_BUCKET_NAME=daham-voc-images
GCP_KEY_FILE=./config/gcp-service-account-key.json

# Image Upload
MAX_IMAGE_SIZE=10485760
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp

# CORS
CORS_ORIGIN=http://localhost:5173,http://localhost:8081

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

#### í”„ë¡œë•ì…˜ í™˜ê²½ (ì„œë²„ì˜ backend/.env)

```env
# Environment
NODE_ENV=production
PORT=3000

# Database (í”„ë¡œë•ì…˜ PostgreSQL - ê°™ì€ ì„œë²„ ë‚´ë¶€)
DATABASE_URL=postgresql://daham_user:cc956697!!@localhost:5432/daham_voc

# JWT
JWT_SECRET=daham_voc_super_secret_key_2025
JWT_EXPIRES_IN=7d

# GCP Storage
GCP_PROJECT_ID=daham-food
GCP_BUCKET_NAME=daham-voc-images
GCP_KEY_FILE=./config/gcp-service-account-key.json

# Image Upload
MAX_IMAGE_SIZE=10485760
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp

# CORS
CORS_ORIGIN=https://dahamvoc.co.kr
```

**âš ï¸ ì¤‘ìš”:** ë¡œì»¬ì—ì„œëŠ” ì ˆëŒ€ í”„ë¡œë•ì…˜ DBì— ì§ì ‘ ì—°ê²°í•˜ì§€ ë§ˆì„¸ìš”!

---

### 2.2 í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ ë³€ìˆ˜

#### ë¡œì»¬ ê°œë°œ í™˜ê²½ (web/.env)

```env
# API (ë¡œì»¬ ë°±ì—”ë“œ ì‚¬ìš©)
VITE_API_BASE_URL=/api/v1

# Kakao Map API Keys
VITE_KAKAO_MAP_APP_KEY=c49d3caee184645323027f84b59a9f8f
VITE_KAKAO_REST_API_KEY=2ec48bfd86a549a69da630e18d685008
```

#### Vite Proxy ì„¤ì • (web/vite.config.ts)

```typescript
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'https://api.dahamvoc.co.kr',  // í”„ë¡œë•ì…˜ API ì‚¬ìš©
        changeOrigin: true,
        secure: false,
      },
    },
  },
})
```

**ë¡œì»¬ ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‹œ:**
```typescript
proxy: {
  '/api': {
    target: 'http://localhost:3000',  // ë¡œì»¬ ë°±ì—”ë“œ
    changeOrigin: true,
  },
}
```

---

## 3. ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 3.1 ì¼ë°˜ì ì¸ ê°œë°œ í”„ë¡œì„¸ìŠ¤

```mermaid
graph TD
    A[ìƒˆ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­] --> B[ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ê°œë°œ]
    B --> C[ë¡œì»¬ DBë¡œ í…ŒìŠ¤íŠ¸]
    C --> D{í…ŒìŠ¤íŠ¸ í†µê³¼?}
    D -->|No| B
    D -->|Yes| E[Git Commit & Push]
    E --> F[í”„ë¡œë•ì…˜ ì„œë²„ ë°°í¬]
    F --> G[ì‹¤ì œ ì„œë¹„ìŠ¤ ë°˜ì˜]
```

### 3.2 ë‹¨ê³„ë³„ ìƒì„¸ ê°€ì´ë“œ

#### Step 1: ë¡œì»¬ ê°œë°œ í™˜ê²½ ì‹¤í–‰

```bash
# 1. ë°±ì—”ë“œ ì‹¤í–‰ (í„°ë¯¸ë„ 1)
cd backend
npm run dev:clean
# âœ… http://localhost:3000 ì‹¤í–‰ ì¤‘

# 2. ì›¹ í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ (í„°ë¯¸ë„ 2)
cd web
npm run dev
# âœ… http://localhost:5173 ì‹¤í–‰ ì¤‘
```

#### Step 2: ê¸°ëŠ¥ ê°œë°œ ë° í…ŒìŠ¤íŠ¸

**ì˜ˆì‹œ: Validator í•„ë“œ ì¶”ê°€**

```typescript
// backend/src/validators/site.validator.ts
export const createSiteSchema = Joi.object({
  name: Joi.string().required(),
  // ... ê¸°ì¡´ í•„ë“œ

  // ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
  mealTypes: Joi.array()
    .items(Joi.string().valid('BREAKFAST', 'LUNCH', 'DINNER', 'SNACK'))
    .optional(),
  pricePerMeal: Joi.number().min(0).optional(),
  deliveryRoute: Joi.string().max(100).optional(),
  contractStartDate: Joi.date().iso().optional(),
  contractEndDate: Joi.date().iso().optional(),
  sortOrder: Joi.number().min(0).optional(),
});
```

**ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸:**
1. ì›¹ ê´€ë¦¬ì ì ‘ì† (http://localhost:5173)
2. ì‚¬ì—…ì¥ ë“±ë¡ ì‹œë„
3. 422 ì—ëŸ¬ ì—†ì´ ì •ìƒ ë“±ë¡ë˜ëŠ”ì§€ í™•ì¸

#### Step 3: Git Commit & Push

```bash
# 1. ë³€ê²½ì‚¬í•­ í™•ì¸
git status

# 2. ë³€ê²½ëœ íŒŒì¼ë§Œ Stage
git add backend/src/validators/site.validator.ts

# 3. Commit (ëª…í™•í•œ ë©”ì‹œì§€ ì‘ì„±)
git commit -m "fix: Add missing fields to site validator

- Add mealTypes, pricePerMeal, deliveryRoute fields
- Add contractStartDate, contractEndDate, sortOrder fields
- Fix 422 validation error on site registration"

# 4. Push to GitHub
git push
```

**Commit ë©”ì‹œì§€ ê·œì¹™:**
- `feat:` ìƒˆ ê¸°ëŠ¥ ì¶”ê°€
- `fix:` ë²„ê·¸ ìˆ˜ì •
- `refactor:` ì½”ë“œ ë¦¬íŒ©í† ë§
- `docs:` ë¬¸ì„œ ìˆ˜ì •
- `chore:` ì„¤ì • ë³€ê²½

#### Step 4: í”„ë¡œë•ì…˜ ë°°í¬

```bash
# 1. SSHë¡œ í”„ë¡œë•ì…˜ ì„œë²„ ì ‘ì†
ssh root@165.246.44.4

# 2. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ~/daham_voc

# 3. Git Pull (ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°)
git pull

# 4. Backend ë¹Œë“œ
cd backend
npm install  # ìƒˆë¡œìš´ íŒ¨í‚¤ì§€ê°€ ì¶”ê°€ëœ ê²½ìš°ë§Œ
npm run build

# 5. PM2ë¡œ ì„œë²„ ì¬ì‹œì‘
pm2 restart daham-voc-api

# 6. ë°°í¬ í™•ì¸
pm2 status
pm2 logs daham-voc-api --lines 20

# 7. SSH ì¢…ë£Œ
exit
```

#### Step 5: ë°°í¬ ê²€ì¦

```bash
# API Health Check
curl https://api.dahamvoc.co.kr/health

# ì›¹ ê´€ë¦¬ì ì ‘ì†
# https://dahamvoc.co.kr
# ì‹¤ì œ ë°ì´í„°ë¡œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```

---

## 4. í”„ë¡œë•ì…˜ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 4.1 ë°°í¬ ìœ í˜•ë³„ ê°€ì´ë“œ

#### ğŸ“ Schema ë³€ê²½ì´ ì—†ëŠ” ê²½ìš° (Validator, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë“±)

```bash
ssh root@165.246.44.4
cd ~/daham_voc
git pull
cd backend
npm run build
pm2 restart daham-voc-api
exit
```

**ì†Œìš” ì‹œê°„:** ~2ë¶„
**ë¦¬ìŠ¤í¬:** ë‚®ìŒ
**ë‹¤ìš´íƒ€ì„:** ì—†ìŒ (PM2ê°€ ìë™ìœ¼ë¡œ ë¬´ì¤‘ë‹¨ ì¬ì‹œì‘)

---

#### ğŸ—„ï¸ Schema ë³€ê²½ì´ ìˆëŠ” ê²½ìš° (DB í…Œì´ë¸” êµ¬ì¡° ë³€ê²½)

```bash
ssh root@165.246.44.4
cd ~/daham_voc/backend

# 1. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… (ì¤‘ìš”!)
pg_dump -U daham_user -h localhost daham_voc > ~/backups/daham_voc_$(date +%Y%m%d_%H%M%S).sql

# 2. Git Pull
cd ~/daham_voc
git pull

# 3. Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
cd backend
npx prisma migrate deploy

# 4. ë¹Œë“œ ë° ì¬ì‹œì‘
npm run build
pm2 restart daham-voc-api

# 5. ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
pm2 logs daham-voc-api --lines 50
```

**ì†Œìš” ì‹œê°„:** ~5ë¶„
**ë¦¬ìŠ¤í¬:** ì¤‘ê°„
**ë‹¤ìš´íƒ€ì„:** 1-2ì´ˆ (ì¬ì‹œì‘ ì‹œ)

---

#### ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì´ ìˆëŠ” ê²½ìš°

**ë°©ë²• 1: í”„ë¡œë•ì…˜ ì›¹ ì„œë²„ê°€ ìˆëŠ” ê²½ìš°**
```bash
ssh root@165.246.44.4
cd ~/daham_voc/web
git pull
npm install  # íŒ¨í‚¤ì§€ ë³€ê²½ì´ ìˆë‹¤ë©´
npm run build
pm2 restart daham-frontend
```

**ë°©ë²• 2: í”„ë¡œë•ì…˜ ì›¹ì´ ì—†ëŠ” ê²½ìš° (í˜„ì¬)**
- ë¡œì»¬ì—ì„œ ê°œë°œ â†’ Git pushë§Œ í•˜ë©´ ë
- í”„ë¡ íŠ¸ì—”ë“œëŠ” Vite proxyë¥¼ í†µí•´ í”„ë¡œë•ì…˜ API ì‚¬ìš©

---

### 4.2 ìë™í™” ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

#### deploy.sh (í”„ë¡œë•ì…˜ ì„œë²„ì— ìƒì„±)

```bash
#!/bin/bash
# ~/daham_voc/deploy.sh

echo "ğŸš€ Daham VOC ë°°í¬ ì‹œì‘..."

cd ~/daham_voc

# Git Pull
echo "ğŸ“¥ Git Pull..."
git pull origin main

# Backend ë°°í¬
echo "ğŸ”§ ë°±ì—”ë“œ ì—…ë°ì´íŠ¸..."
cd backend
npm install
npm run build
pm2 restart daham-voc-api

# ìƒíƒœ í™•ì¸
echo "âœ… ë°°í¬ ì™„ë£Œ!"
pm2 status
pm2 logs daham-voc-api --lines 10
```

**ì‚¬ìš© ë°©ë²•:**
```bash
ssh root@165.246.44.4
~/daham_voc/deploy.sh
```

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

### 5.1 ë¡œì»¬ DB vs í”„ë¡œë•ì…˜ DB

| êµ¬ë¶„ | ë¡œì»¬ DB | í”„ë¡œë•ì…˜ DB |
|------|---------|------------|
| **ìš©ë„** | ê°œë°œ, í…ŒìŠ¤íŠ¸ | ì‹¤ì œ ì„œë¹„ìŠ¤ |
| **ë°ì´í„°** | í…ŒìŠ¤íŠ¸ ë°ì´í„° | ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„° |
| **ì ‘ì† ë°©ë²•** | ì§ì ‘ ì ‘ì† | SSH í„°ë„ ë˜ëŠ” ì„œë²„ ë‚´ë¶€ì—ì„œë§Œ |
| **ë°±ì—…** | ì„ íƒì‚¬í•­ | í•„ìˆ˜ (ë§¤ì¼ ìë™ ë°±ì—…) |
| **ì‹¤ìˆ˜ ì˜í–¥** | ì—†ìŒ | ì‹¬ê° |

### 5.2 í”„ë¡œë•ì…˜ DB ì ‘ì† ë°©ë²•

#### ë°©ë²• 1: SSHë¡œ ì„œë²„ ì ‘ì† í›„ psql ì‚¬ìš© (ê¶Œì¥)

```bash
# 1. SSH ì ‘ì†
ssh root@165.246.44.4

# 2. PostgreSQL ì ‘ì†
psql -U daham_user -d daham_voc

# 3. ì¿¼ë¦¬ ì‹¤í–‰
daham_voc=# SELECT COUNT(*) FROM "Site";
daham_voc=# \dt  -- í…Œì´ë¸” ëª©ë¡
daham_voc=# \q   -- ì¢…ë£Œ
```

#### ë°©ë²• 2: SSH í„°ë„ë§ (ê³ ê¸‰)

```bash
# ë¡œì»¬ì—ì„œ SSH í„°ë„ ìƒì„±
ssh -L 5433:localhost:5432 root@165.246.44.4

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ë¡œì»¬ í¬íŠ¸ë¡œ ì ‘ì†
psql -h localhost -p 5433 -U daham_user -d daham_voc
```

**âš ï¸ ì£¼ì˜:** í”„ë¡œë•ì…˜ DBì— ì§ì ‘ ì—°ê²°í•  ë•ŒëŠ” í•­ìƒ ì¡°ì‹¬í•˜ì„¸ìš”!

### 5.3 ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…

#### ìë™ ë°±ì—… ì„¤ì • (í”„ë¡œë•ì…˜ ì„œë²„)

```bash
# ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
nano ~/backup-db.sh
```

```bash
#!/bin/bash
BACKUP_DIR=~/backups
mkdir -p $BACKUP_DIR
DATE=$(date +%Y%m%d_%H%M%S)
PGPASSWORD=cc956697!! pg_dump -U daham_user -h localhost daham_voc > $BACKUP_DIR/daham_voc_$DATE.sql
echo "âœ… ë°±ì—… ì™„ë£Œ: $BACKUP_DIR/daham_voc_$DATE.sql"

# 7ì¼ ì´ìƒ ëœ ë°±ì—… ì‚­ì œ
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
```

```bash
# ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x ~/backup-db.sh

# Cron ì„¤ì • (ë§¤ì¼ ìƒˆë²½ 2ì‹œ)
crontab -e
# ì¶”ê°€:
0 2 * * * ~/backup-db.sh
```

#### ìˆ˜ë™ ë°±ì—…

```bash
# ì¦‰ì‹œ ë°±ì—…
ssh root@165.246.44.4
~/backup-db.sh
```

### 5.4 Schema ë³€ê²½ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜

#### Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± (ë¡œì»¬)

```bash
# 1. Prisma Schema ìˆ˜ì •
# prisma/schema.prisma

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
npx prisma migrate dev --name add_new_field

# 3. Git Commit
git add prisma/
git commit -m "feat: Add new field to Site model"
git push
```

#### í”„ë¡œë•ì…˜ ì ìš©

```bash
ssh root@165.246.44.4
cd ~/daham_voc/backend

# ë°±ì—… ë¨¼ì €!
pg_dump -U daham_user daham_voc > ~/backups/before_migration_$(date +%Y%m%d).sql

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
npx prisma migrate deploy

# ì¬ì‹œì‘
pm2 restart daham-voc-api
```

---

## 6. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 6.1 ë°°í¬ í›„ 422 Validation ì—ëŸ¬

**ì¦ìƒ:**
```
POST /api/v1/sites 422 (Unprocessable Entity)
```

**ì›ì¸:**
- Validatorì— í•„ë“œê°€ ëˆ„ë½ë¨
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë³´ë‚´ëŠ” ë°ì´í„°ì™€ validator ë¶ˆì¼ì¹˜

**í•´ê²°:**
```bash
# 1. ë¡œì»¬ì—ì„œ validator í™•ì¸
# backend/src/validators/site.validator.ts

# 2. í•„ë“œ ì¶”ê°€
export const createSiteSchema = Joi.object({
  // ëˆ„ë½ëœ í•„ë“œ ì¶”ê°€
});

# 3. ë°°í¬
git add backend/src/validators/site.validator.ts
git commit -m "fix: Add missing fields to validator"
git push

# 4. í”„ë¡œë•ì…˜ ë°°í¬
ssh root@165.246.44.4
cd ~/daham_voc && git pull
cd backend && npm run build && pm2 restart daham-voc-api
```

---

### 6.2 PM2 í”„ë¡œì„¸ìŠ¤ê°€ ê³„ì† ì¬ì‹œì‘ë¨

**ì¦ìƒ:**
```bash
pm2 status
# daham-voc-api  â”‚ errored  â”‚ 50  â”‚
```

**ì›ì¸ í™•ì¸:**
```bash
pm2 logs daham-voc-api --lines 50
```

**ì¼ë°˜ì ì¸ ì›ì¸:**
1. DATABASE_URL ì˜¤ë¥˜
2. í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½
3. TypeScript ë¹Œë“œ ì˜¤ë¥˜

**í•´ê²°:**
```bash
# 1. í™˜ê²½ ë³€ìˆ˜ í™•ì¸
cat ~/daham_voc/backend/.env

# 2. ë¹Œë“œ ì˜¤ë¥˜ í™•ì¸
cd ~/daham_voc/backend
npm run build

# 3. ìˆ˜ë™ ì‹¤í–‰ìœ¼ë¡œ ì—ëŸ¬ í™•ì¸
node dist/server.js

# 4. ì •ìƒì´ë©´ PM2 ì¬ì‹œì‘
pm2 delete daham-voc-api
pm2 start dist/server.js --name daham-voc-api
```

---

### 6.3 PostgreSQL ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ:**
```
Can't reach database server at `localhost:5432`
```

**í•´ê²°:**
```bash
# PostgreSQL ìƒíƒœ í™•ì¸
sudo systemctl status postgresql

# ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆë©´ ì‹œì‘
sudo systemctl start postgresql

# ìë™ ì‹œì‘ ì„¤ì •
sudo systemctl enable postgresql
```

---

### 6.4 Git Pull ì¶©ëŒ ë°œìƒ

**ì¦ìƒ:**
```
error: Your local changes to the following files would be overwritten by merge
```

**í•´ê²°:**
```bash
# ë¡œì»¬ ë³€ê²½ì‚¬í•­ í™•ì¸
git status

# ë°©ë²• 1: ë¡œì»¬ ë³€ê²½ì‚¬í•­ ë²„ë¦¬ê¸° (ì„œë²„ì—ì„œë§Œ!)
git reset --hard HEAD
git pull

# ë°©ë²• 2: ë¡œì»¬ ë³€ê²½ì‚¬í•­ ë³´ê´€
git stash
git pull
git stash pop  # í•„ìš”í•˜ë‹¤ë©´
```

---

### 6.5 Kakao API 401 Unauthorized

**ì¦ìƒ:**
```
GET https://dapi.kakao.com/v2/local/search/address.json 401 (Unauthorized)
```

**ì›ì¸:**
- JavaScript í‚¤ë¡œ REST API í˜¸ì¶œ
- í”Œë«í¼ ë„ë©”ì¸ ë¯¸ë“±ë¡

**í•´ê²°:**
```bash
# 1. .env íŒŒì¼ í™•ì¸
cat web/.env
# VITE_KAKAO_REST_API_KEYê°€ ìˆëŠ”ì§€ í™•ì¸

# 2. Kakao Developers Consoleì—ì„œ í”Œë«í¼ ë“±ë¡
# https://developers.kakao.com/
# - Web: http://localhost:5173, https://dahamvoc.co.kr
# - Android: íŒ¨í‚¤ì§€ëª… ë“±ë¡
```

---

## 7. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 7.1 ê°œë°œ ì‹œì‘ ì „

- [ ] ë¡œì»¬ ë°±ì—”ë“œ ì‹¤í–‰ ì¤‘
- [ ] ë¡œì»¬ PostgreSQL ì‹¤í–‰ ì¤‘
- [ ] backend/.envê°€ ë¡œì»¬ DB ì‚¬ìš© ì¤‘
- [ ] Git branchê°€ mainì¸ì§€ í™•ì¸

### 7.2 ë°°í¬ ì „

- [ ] ë¡œì»¬ì—ì„œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] Validator ë³€ê²½ì‚¬í•­ í™•ì¸
- [ ] Migration í•„ìš” ì—¬ë¶€ í™•ì¸
- [ ] Git commit ë©”ì‹œì§€ ëª…í™•íˆ ì‘ì„±
- [ ] Git push ì™„ë£Œ

### 7.3 ë°°í¬ í›„

- [ ] PM2 ìƒíƒœ ì •ìƒ (online)
- [ ] PM2 ë¡œê·¸ ì—ëŸ¬ ì—†ìŒ
- [ ] API Health Check ì •ìƒ
- [ ] ì›¹ ê´€ë¦¬ìì—ì„œ ê¸°ëŠ¥ ë™ì‘ í™•ì¸
- [ ] ì‚¬ìš©ìì—ê²Œ ë³€ê²½ì‚¬í•­ ê³µì§€ (í•„ìš”ì‹œ)

---

## 8. ì£¼ìš” ëª…ë ¹ì–´ ìš”ì•½

### Git ê´€ë ¨

```bash
git status                    # ë³€ê²½ì‚¬í•­ í™•ì¸
git add .                     # ëª¨ë“  ë³€ê²½ì‚¬í•­ Stage
git commit -m "message"       # Commit
git push                      # Push to GitHub
git pull                      # ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
git log --oneline -10         # ìµœê·¼ 10ê°œ ì»¤ë°‹ í™•ì¸
```

### ë¡œì»¬ ê°œë°œ

```bash
# ë°±ì—”ë“œ
cd backend
npm run dev:clean             # ê°œë°œ ì„œë²„ ì‹œì‘
npm run build                 # TypeScript ë¹Œë“œ
npx prisma studio             # Prisma DB GUI

# í”„ë¡ íŠ¸ì—”ë“œ
cd web
npm run dev                   # Vite ê°œë°œ ì„œë²„
npm run build                 # í”„ë¡œë•ì…˜ ë¹Œë“œ
```

### í”„ë¡œë•ì…˜ ë°°í¬

```bash
ssh root@165.246.44.4         # SSH ì ‘ì†
cd ~/daham_voc && git pull    # ì½”ë“œ ì—…ë°ì´íŠ¸
cd backend && npm run build   # ë¹Œë“œ
pm2 restart daham-voc-api     # ì¬ì‹œì‘
pm2 status                    # ìƒíƒœ í™•ì¸
pm2 logs daham-voc-api        # ë¡œê·¸ í™•ì¸
exit                          # SSH ì¢…ë£Œ
```

### ë°ì´í„°ë² ì´ìŠ¤

```bash
# ë¡œì»¬
psql -U postgres -d daham_voc

# í”„ë¡œë•ì…˜ (SSH ì ‘ì† í›„)
psql -U daham_user -d daham_voc

# ë°±ì—…
pg_dump -U daham_user daham_voc > backup.sql

# ë³µì›
psql -U daham_user daham_voc < backup.sql
```

---

## 9. ì°¸ê³  ìë£Œ

### ë‚´ë¶€ ë¬¸ì„œ
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - GCP VM ë°°í¬ ê°€ì´ë“œ
- [ê°œë°œ_ê°€ì´ë“œ.md](./ê°œë°œ_ê°€ì´ë“œ.md) - ê¸°ë³¸ ê°œë°œ ê°€ì´ë“œ
- [ìš´ì˜_ê°€ì´ë“œ.md](./ìš´ì˜_ê°€ì´ë“œ.md) - ì‹œìŠ¤í…œ ìš´ì˜ ê°€ì´ë“œ

### ì™¸ë¶€ ë§í¬
- [Git ê¸°ì´ˆ ì‚¬ìš©ë²•](https://git-scm.com/book/ko/v2)
- [PM2 ê³µì‹ ë¬¸ì„œ](https://pm2.keymetrics.io/docs/usage/quick-start/)
- [Prisma ë§ˆì´ê·¸ë ˆì´ì…˜](https://www.prisma.io/docs/concepts/components/prisma-migrate)
- [PostgreSQL ë°±ì—… ê°€ì´ë“œ](https://www.postgresql.org/docs/current/backup.html)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-10-18
**ì‘ì„±ì:** Claude Code Assistant
