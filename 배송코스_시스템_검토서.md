# ë°°ì†¡ì½”ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê¸°ìˆ  ê²€í† ì„œ

> **ì‘ì„±ì¼**: 2025-10-18
> **ê²€í†  ëª©ì **: ë°°ì†¡ì½”ìŠ¤ ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥ì„± ë° ì„¤ê³„ ë°©ì•ˆ ê²€í† 

---

## ğŸ“‹ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

### 1. ì‚¬ì—…ì¥ ë²ˆí˜¸ ë¶€ì—¬
- ë“±ë¡ëœ ì‚¬ì—…ì¥ì— ê° ë²ˆí˜¸ë¥¼ ë¶€ì—¬

### 2. ë°°ì†¡ ì½”ìŠ¤ ìƒì„±
- A, B, C, D ë“±ì˜ ì½”ìŠ¤ ë§Œë“¤ê¸°
- ê° ì½”ìŠ¤ì— ì‚¬ì—…ì¥ ë°°ì •

### 3. ì—­í• ë³„ ê¶Œí•œ
- **ë°°ì†¡ê¸°ì‚¬**: ìì‹ ì˜ ì½”ìŠ¤ë§Œ ì¡°íšŒ
- **ê´€ë¦¬ì**: ì „ì²´ ì½”ìŠ¤ ê´€ë¦¬ (ìƒì„±, ìˆ˜ì •, ì‚­ì œ)

### 4. ë°°ì†¡ ì¶”ì  ë° ê¸°ë¡
- ê° ì‚¬ì—…ì¥ ë„ì°© ì‹œê°„ ìë™ ê¸°ë¡
- GPS ê¸°ë°˜ ì´ë™ ê²½ë¡œ ì¶”ì 
- ì´ë ¥ ë°ì´í„° ì €ì¥ ë° ë¶„ì„

### 5. ê²½ë¡œ ì‹œë®¬ë ˆì´ì…˜
- ì‚¬ì—…ì¥ ê°„ ì´ë™ ì‹œê°„ ì˜ˆì¸¡
- ìµœì  ê²½ë¡œ ì œì•ˆ

### 6. ì‹œìŠ¤í…œ ë¶€í•˜ ë¶„ì„
- ì„±ëŠ¥ ì˜í–¥ë„ ì˜ˆì¸¡

---

## âœ… êµ¬í˜„ ê°€ëŠ¥ì„± ë¶„ì„

### í˜„ì¬ ì‹œìŠ¤í…œ í˜„í™©

#### ì´ë¯¸ êµ¬í˜„ëœ ê¸°ëŠ¥
| ê¸°ëŠ¥ | í˜„ì¬ ìƒíƒœ | í™œìš© ê°€ëŠ¥ ì—¬ë¶€ |
|------|----------|--------------|
| **Site ëª¨ë¸** | âœ… latitude, longitude ì¡´ì¬ | âœ… GPS ì¢Œí‘œ í™œìš© ê°€ëŠ¥ |
| **deliveryRoute í•„ë“œ** | âœ… String íƒ€ì…ìœ¼ë¡œ ì¡´ì¬ | âœ… ì½”ìŠ¤ëª… ì €ì¥ ê°€ëŠ¥ |
| **sortOrder í•„ë“œ** | âœ… ì¡´ì¬ | âœ… ë°©ë¬¸ ìˆœì„œ ê´€ë¦¬ ê°€ëŠ¥ |
| **DELIVERY_DRIVER ì—­í• ** | âœ… Role enumì— ì¡´ì¬ | âœ… ë°°ì†¡ê¸°ì‚¬ ê¶Œí•œ ë¶„ë¦¬ ê°€ëŠ¥ |
| **Attendance GPS** | âœ… checkInLat, checkInLng | âœ… ìœ„ì¹˜ ì¶”ì  ë¡œì§ ì°¸ê³  ê°€ëŠ¥ |
| **StaffSite ì—°ê²°** | âœ… ì§ì›-ì‚¬ì—…ì¥ ë§¤í•‘ | âœ… ê¸°ì‚¬-ì½”ìŠ¤ ë°°ì • ê°€ëŠ¥ |

#### ì‹ ê·œ ê°œë°œ í•„ìš” ì‚¬í•­
- ë°°ì†¡ ì½”ìŠ¤ ì „ìš© ëª¨ë¸ (DeliveryRoute)
- ë°°ì†¡ ê¸°ë¡ ëª¨ë¸ (DeliveryLog)
- GPS ì‹¤ì‹œê°„ ì¶”ì  ë¡œì§
- Kakao/Google Maps API ì—°ë™ (ê±°ë¦¬/ì‹œê°„ ê³„ì‚°)

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ì‹ ê·œ ëª¨ë¸ ì¶”ê°€

#### 1. DeliveryRoute (ë°°ì†¡ ì½”ìŠ¤)

```prisma
model DeliveryRoute {
  id          String   @id @default(uuid())
  name        String   @unique           // "Aì½”ìŠ¤", "Bì½”ìŠ¤"
  code        String   @unique           // "A", "B", "C"
  division    Division                   // HQ, YEONGNAM
  description String?                    // ì½”ìŠ¤ ì„¤ëª…
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?

  // Relations
  routeStops      DeliveryRouteStop[]    // ì½”ìŠ¤ ë‚´ ì‚¬ì—…ì¥ ëª©ë¡
  assignments     DeliveryAssignment[]   // ê¸°ì‚¬ ë°°ì •
  deliveryLogs    DeliveryLog[]          // ë°°ì†¡ ê¸°ë¡

  @@index([division])
  @@index([isActive])
}
```

#### 2. DeliveryRouteStop (ì½”ìŠ¤ ë‚´ ì‚¬ì—…ì¥ ìˆœì„œ)

```prisma
model DeliveryRouteStop {
  id                String   @id @default(uuid())
  routeId           String
  siteId            String
  stopNumber        Int                   // ë°©ë¬¸ ìˆœì„œ (1, 2, 3...)
  estimatedArrival  String?               // ì˜ˆìƒ ë„ì°© ì‹œê°„ "09:30"
  estimatedDuration Int?                  // ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ë¶„)
  notes             String?               // íŠ¹ì´ì‚¬í•­
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  route    DeliveryRoute @relation(fields: [routeId], references: [id], onDelete: Cascade)
  site     Site          @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([routeId, siteId])      // ê°™ì€ ì½”ìŠ¤ì— ì¤‘ë³µ ì‚¬ì—…ì¥ ë°©ì§€
  @@unique([routeId, stopNumber])  // ê°™ì€ ì½”ìŠ¤ì— ì¤‘ë³µ ìˆœì„œ ë°©ì§€
  @@index([routeId, stopNumber])
  @@index([siteId])
}
```

#### 3. DeliveryAssignment (ê¸°ì‚¬ ë°°ì •)

```prisma
model DeliveryAssignment {
  id         String    @id @default(uuid())
  routeId    String
  driverId   String                        // User.id (DELIVERY_DRIVER)
  assignedAt DateTime  @default(now())
  removedAt  DateTime?
  isActive   Boolean   @default(true)

  // Relations
  route  DeliveryRoute @relation(fields: [routeId], references: [id], onDelete: Cascade)
  driver User          @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@unique([routeId, driverId])
  @@index([driverId])
  @@index([routeId])
}
```

#### 4. DeliveryLog (ë°°ì†¡ ê¸°ë¡)

```prisma
model DeliveryLog {
  id              String          @id @default(uuid())
  routeId         String
  siteId          String
  driverId        String
  deliveryDate    DateTime        @db.Date       // ë°°ì†¡ ë‚ ì§œ
  stopNumber      Int                            // ë°©ë¬¸ ìˆœì„œ

  // GPS ë° ì‹œê°„ ì •ë³´
  arrivedAt       DateTime?                      // ì‹¤ì œ ë„ì°© ì‹œê°„
  departedAt      DateTime?                      // ì¶œë°œ ì‹œê°„
  arrivalLat      Float?                         // ë„ì°© ì‹œ GPS
  arrivalLng      Float?
  departureLat    Float?                         // ì¶œë°œ ì‹œ GPS
  departureLng    Float?

  // ë°°ì†¡ ìƒíƒœ
  status          DeliveryStatus  @default(PENDING)
  actualDuration  Int?                           // ì‹¤ì œ ì†Œìš” ì‹œê°„ (ë¶„)
  distanceKm      Float?                         // ì´ë™ ê±°ë¦¬

  // ë©”ëª¨
  note            String?
  issueReported   Boolean         @default(false)
  issueDetail     String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  route  DeliveryRoute @relation(fields: [routeId], references: [id], onDelete: Cascade)
  site   Site          @relation(fields: [siteId], references: [id], onDelete: Cascade)
  driver User          @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@unique([routeId, siteId, deliveryDate])   // í•˜ë£¨ì— í•œ ë²ˆë§Œ ë°°ì†¡
  @@index([deliveryDate])
  @@index([driverId, deliveryDate])
  @@index([routeId, deliveryDate])
  @@index([status])
}

enum DeliveryStatus {
  PENDING      // ëŒ€ê¸°
  IN_TRANSIT   // ì´ë™ ì¤‘
  ARRIVED      // ë„ì°©
  COMPLETED    // ì™„ë£Œ
  DELAYED      // ì§€ì—°
  ISSUE        // ë¬¸ì œ ë°œìƒ
}
```

#### 5. Site ëª¨ë¸ ì—…ë°ì´íŠ¸

```prisma
model Site {
  // ... ê¸°ì¡´ í•„ë“œ

  // ìƒˆë¡œ ì¶”ê°€
  routeStops   DeliveryRouteStop[]  // ì½”ìŠ¤ ì •ë¥˜ì¥
  deliveryLogs DeliveryLog[]        // ë°°ì†¡ ê¸°ë¡
}
```

#### 6. User ëª¨ë¸ ì—…ë°ì´íŠ¸

```prisma
model User {
  // ... ê¸°ì¡´ í•„ë“œ

  // ìƒˆë¡œ ì¶”ê°€
  deliveryAssignments DeliveryAssignment[]  // ë°°ì†¡ ê¸°ì‚¬ ë°°ì •
  deliveryLogs        DeliveryLog[]         // ë°°ì†¡ ê¸°ë¡
}
```

---

## ğŸ”§ ê¸°ëŠ¥ë³„ êµ¬í˜„ ë°©ì•ˆ

### 1. ì‚¬ì—…ì¥ ë²ˆí˜¸ ë¶€ì—¬

**í˜„ì¬ ìƒí™©:**
- Site ëª¨ë¸ì— `sortOrder` í•„ë“œ ì¡´ì¬

**êµ¬í˜„ ë°©ì•ˆ:**
```typescript
// ì½”ìŠ¤ ë‚´ ìˆœì„œëŠ” DeliveryRouteStop.stopNumber ì‚¬ìš©
// ì „ì²´ ì‚¬ì—…ì¥ ìˆœì„œëŠ” ê¸°ì¡´ Site.sortOrder í™œìš©
```

**ì˜ˆì‹œ:**
```
Aì½”ìŠ¤:
  1ë²ˆ: ì‚¼ì„±ì „ì ë³¸ì‚¬
  2ë²ˆ: LGì „ì ë¹Œë”©
  3ë²ˆ: í˜„ëŒ€ìë™ì°¨ ì‚¬ì˜¥

Bì½”ìŠ¤:
  1ë²ˆ: SKí•˜ì´ë‹‰ìŠ¤
  2ë²ˆ: ì¹´ì¹´ì˜¤
  3ë²ˆ: ë„¤ì´ë²„
```

---

### 2. ë°°ì†¡ ì½”ìŠ¤ ìƒì„± ë° ê´€ë¦¬

#### ê´€ë¦¬ì ê¸°ëŠ¥ (ì›¹ ê´€ë¦¬ì)

**ì½”ìŠ¤ ìƒì„± í˜ì´ì§€**
```
ê²½ë¡œ: /delivery-routes
ê¸°ëŠ¥:
  - ì½”ìŠ¤ ëª©ë¡ ì¡°íšŒ (Table)
  - ì½”ìŠ¤ ìƒì„± (Modal)
    * ì½”ìŠ¤ëª…: Aì½”ìŠ¤, Bì½”ìŠ¤
    * ì½”ë“œ: A, B, C
    * ë¶€ë¬¸: ë³¸ì‚¬/ì˜ë‚¨ì§€ì‚¬
    * ì„¤ëª…: ì„ íƒì‚¬í•­
  - ì½”ìŠ¤ ìˆ˜ì •/ì‚­ì œ
```

**ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€**
```
ê²½ë¡œ: /delivery-routes/:id
ê¸°ëŠ¥:
  - ì‚¬ì—…ì¥ ì¶”ê°€/ì œê±° (Transfer ì»´í¬ë„ŒíŠ¸)
  - ë°©ë¬¸ ìˆœì„œ ì¡°ì • (Drag & Drop)
  - ì˜ˆìƒ ë„ì°© ì‹œê°„ ì„¤ì •
  - ê¸°ì‚¬ ë°°ì •
```

**ì‹œê°í™”**
```tsx
// ì§€ë„ì— ì½”ìŠ¤ ê²½ë¡œ í‘œì‹œ
<KakaoMap>
  {routeStops.map((stop, index) => (
    <Marker
      position={{ lat: stop.site.latitude, lng: stop.site.longitude }}
      label={`${index + 1}`}
    />
  ))}
  <Polyline path={routeStops} />  // ê²½ë¡œ ì„ 
</KakaoMap>
```

---

### 3. ë°°ì†¡ê¸°ì‚¬ ì•± (ëª¨ë°”ì¼)

#### ì˜¤ëŠ˜ì˜ ë°°ì†¡ ì½”ìŠ¤ ì¡°íšŒ

```tsx
// mobile/src/screens/DeliveryRouteScreen.tsx
function DeliveryRouteScreen() {
  const { data: myRoute } = useQuery(['my-route', today],
    () => getMyDeliveryRoute(today)
  );

  return (
    <ScrollView>
      <RouteHeader route={myRoute} />

      {myRoute.stops.map((stop) => (
        <StopCard
          key={stop.id}
          stopNumber={stop.stopNumber}
          siteName={stop.site.name}
          address={stop.site.address}
          estimatedArrival={stop.estimatedArrival}
          status={stop.deliveryLog?.status}
          onCheckIn={() => handleCheckIn(stop)}
          onComplete={() => handleComplete(stop)}
        />
      ))}
    </ScrollView>
  );
}
```

#### ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ê¸°ëŠ¥

```tsx
async function handleCheckIn(stop: RouteStop) {
  // 1. GPS ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°
  const location = await getCurrentLocation();

  // 2. ë„ì°© ê¸°ë¡
  await createDeliveryLog({
    routeId: stop.routeId,
    siteId: stop.siteId,
    arrivedAt: new Date(),
    arrivalLat: location.latitude,
    arrivalLng: location.longitude,
    status: 'ARRIVED',
  });

  // 3. ì•Œë¦¼
  Alert.alert('ì²´í¬ì¸ ì™„ë£Œ', `${stop.site.name}ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤`);
}
```

---

### 4. GPS ì¶”ì  ë° ê¸°ë¡

#### ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  (ë°±ê·¸ë¼ìš´ë“œ)

```typescript
// mobile/src/services/location-tracking.ts
import * as Location from 'expo-location';
import * as TaskManager from 'expo-task-manager';

const LOCATION_TASK_NAME = 'background-location-task';

// ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  ë“±ë¡
TaskManager.defineTask(LOCATION_TASK_NAME, async ({ data, error }) => {
  if (error) {
    console.error(error);
    return;
  }

  const { locations } = data as any;
  const location = locations[0];

  // ì„œë²„ë¡œ ìœ„ì¹˜ ì „ì†¡
  await sendLocationToServer({
    latitude: location.coords.latitude,
    longitude: location.coords.longitude,
    timestamp: new Date(location.timestamp),
  });
});

// ì¶”ì  ì‹œì‘
export async function startLocationTracking() {
  await Location.startLocationUpdatesAsync(LOCATION_TASK_NAME, {
    accuracy: Location.Accuracy.High,
    timeInterval: 30000,  // 30ì´ˆë§ˆë‹¤
    distanceInterval: 100, // 100m ì´ë™ ì‹œ
    foregroundService: {
      notificationTitle: 'ë°°ì†¡ ì¤‘',
      notificationBody: 'ìœ„ì¹˜ê°€ ì¶”ì ë˜ê³  ìˆìŠµë‹ˆë‹¤',
    },
  });
}
```

#### ë„ì°© ê°ì§€ (Geofencing)

```typescript
// ì‚¬ì—…ì¥ ë°˜ê²½ 100m ì´ë‚´ ì§„ì… ì‹œ ìë™ ì²´í¬ì¸
import * as Location from 'expo-location';

async function setupGeofencing(stops: RouteStop[]) {
  await Location.startGeofencingAsync('DELIVERY_GEOFENCE',
    stops.map(stop => ({
      identifier: stop.siteId,
      latitude: stop.site.latitude,
      longitude: stop.site.longitude,
      radius: 100, // 100m
      notifyOnEnter: true,
      notifyOnExit: true,
    }))
  );
}

// Geofence ì´ë²¤íŠ¸ ì²˜ë¦¬
TaskManager.defineTask('DELIVERY_GEOFENCE', async ({ data, error }) => {
  const { eventType, region } = data as any;

  if (eventType === Location.GeofencingEventType.Enter) {
    // ì‚¬ì—…ì¥ ë°˜ê²½ ì§„ì… â†’ ìë™ ì²´í¬ì¸ ì œì•ˆ
    showCheckInNotification(region.identifier);
  }
});
```

---

### 5. ê²½ë¡œ ì‹œë®¬ë ˆì´ì…˜ (ì´ë™ ì‹œê°„ ì˜ˆì¸¡)

#### Kakao Mobility API ì—°ë™

```typescript
// backend/src/services/route-optimization.service.ts
import axios from 'axios';

export class RouteOptimizationService {
  private kakaoRestApiKey = process.env.KAKAO_REST_API_KEY;

  /**
   * ë‘ ì§€ì  ê°„ ì´ë™ ì‹œê°„ ë° ê±°ë¦¬ ê³„ì‚°
   */
  async calculateRoute(
    origin: { lat: number; lng: number },
    destination: { lat: number; lng: number }
  ) {
    const url = 'https://apis-navi.kakaomobility.com/v1/directions';

    const response = await axios.get(url, {
      params: {
        origin: `${origin.lng},${origin.lat}`,
        destination: `${destination.lng},${destination.lat}`,
        priority: 'RECOMMEND', // ì¶”ì²œ ê²½ë¡œ
      },
      headers: {
        Authorization: `KakaoAK ${this.kakaoRestApiKey}`,
      },
    });

    const route = response.data.routes[0];

    return {
      distanceMeters: route.summary.distance,      // ê±°ë¦¬ (m)
      durationSeconds: route.summary.duration,     // ì†Œìš” ì‹œê°„ (ì´ˆ)
      distanceKm: route.summary.distance / 1000,
      durationMinutes: Math.ceil(route.summary.duration / 60),
    };
  }

  /**
   * ì „ì²´ ì½”ìŠ¤ ì‹œë®¬ë ˆì´ì…˜
   */
  async simulateRoute(stops: RouteStop[]) {
    const segments = [];
    let totalDistance = 0;
    let totalDuration = 0;
    let currentTime = new Date('2025-01-01 08:00'); // ì‹œì‘ ì‹œê°„

    for (let i = 0; i < stops.length - 1; i++) {
      const origin = {
        lat: stops[i].site.latitude,
        lng: stops[i].site.longitude
      };
      const destination = {
        lat: stops[i + 1].site.latitude,
        lng: stops[i + 1].site.longitude
      };

      const route = await this.calculateRoute(origin, destination);

      totalDistance += route.distanceKm;
      totalDuration += route.durationMinutes;

      currentTime = new Date(currentTime.getTime() + route.durationMinutes * 60000);

      segments.push({
        from: stops[i].site.name,
        to: stops[i + 1].site.name,
        distance: route.distanceKm,
        duration: route.durationMinutes,
        estimatedArrival: currentTime.toISOString(),
      });
    }

    return {
      totalDistance,
      totalDuration,
      segments,
    };
  }

  /**
   * ê²½ë¡œ ìµœì í™” (TSP - Traveling Salesman Problem)
   */
  async optimizeRoute(sites: Site[], startPoint: { lat: number; lng: number }) {
    // ê°„ë‹¨í•œ Nearest Neighbor ì•Œê³ ë¦¬ì¦˜
    const unvisited = [...sites];
    const optimized: Site[] = [];
    let current = startPoint;

    while (unvisited.length > 0) {
      let nearest = null;
      let minDistance = Infinity;

      for (const site of unvisited) {
        const route = await this.calculateRoute(current, {
          lat: site.latitude,
          lng: site.longitude,
        });

        if (route.distanceKm < minDistance) {
          minDistance = route.distanceKm;
          nearest = site;
        }
      }

      if (nearest) {
        optimized.push(nearest);
        current = { lat: nearest.latitude, lng: nearest.longitude };
        unvisited.splice(unvisited.indexOf(nearest), 1);
      }
    }

    return optimized;
  }
}
```

#### ê´€ë¦¬ì ì‹œë®¬ë ˆì´ì…˜ ê¸°ëŠ¥

```tsx
// web/src/pages/delivery-route/RouteSimulationPage.tsx
function RouteSimulationPage() {
  const [simulation, setSimulation] = useState(null);

  async function handleSimulate() {
    const result = await simulateDeliveryRoute(routeId);
    setSimulation(result);
  }

  return (
    <Card>
      <Button onClick={handleSimulate}>ê²½ë¡œ ì‹œë®¬ë ˆì´ì…˜</Button>

      {simulation && (
        <div>
          <Statistic title="ì´ ê±°ë¦¬" value={simulation.totalDistance} suffix="km" />
          <Statistic title="ì´ ì†Œìš” ì‹œê°„" value={simulation.totalDuration} suffix="ë¶„" />

          <Timeline>
            {simulation.segments.map((seg, i) => (
              <Timeline.Item key={i}>
                <strong>{seg.to}</strong>
                <br />
                ë„ì°© ì˜ˆì •: {seg.estimatedArrival}
                <br />
                ì†Œìš”: {seg.duration}ë¶„ ({seg.distance}km)
              </Timeline.Item>
            ))}
          </Timeline>
        </div>
      )}
    </Card>
  );
}
```

---

## ğŸ“Š ì‹œìŠ¤í…œ ë¶€í•˜ ë¶„ì„

### 1. ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜

#### ì˜ˆìƒ ë°ì´í„°ëŸ‰ (500ê°œ ì‚¬ì—…ì¥ ê¸°ì¤€)

| í…Œì´ë¸” | ë ˆì½”ë“œ ìˆ˜ | ì›”ê°„ ì¦ê°€ëŸ‰ | ì—°ê°„ ì¦ê°€ëŸ‰ |
|--------|----------|-----------|-----------|
| **DeliveryRoute** | 20ê°œ ì½”ìŠ¤ | +2 | +24 |
| **DeliveryRouteStop** | 500ê°œ (ì½”ìŠ¤ë‹¹ 25ê°œ) | +50 | +600 |
| **DeliveryAssignment** | 20ê°œ (ê¸°ì‚¬ 20ëª…) | +2 | +24 |
| **DeliveryLog** | 10,000ê°œ/ì¼ | 300,000 | 3,600,000 |

**ì—°ê°„ DeliveryLog ì¦ê°€ëŸ‰:**
- í•˜ë£¨ 500ê°œ ì‚¬ì—…ì¥ Ã— í‰ê·  1íšŒ ë°©ë¬¸ = 500ê°œ
- ì›” 500 Ã— 20ì¼ = 10,000ê°œ
- **ì—° 120,000ê°œ**

#### ì¸ë±ìŠ¤ ìµœì í™”

```sql
-- ìì£¼ ì¡°íšŒë˜ëŠ” ì¿¼ë¦¬
SELECT * FROM DeliveryLog
WHERE driverId = ? AND deliveryDate = ?
ORDER BY stopNumber;

-- ì¸ë±ìŠ¤ ì „ëµ
CREATE INDEX idx_delivery_log_driver_date
ON DeliveryLog(driverId, deliveryDate);

CREATE INDEX idx_delivery_log_route_date
ON DeliveryLog(routeId, deliveryDate);
```

#### íŒŒí‹°ì…”ë‹ (1ë…„ í›„)

```sql
-- ì›”ë³„ íŒŒí‹°ì…”ë‹
CREATE TABLE DeliveryLog_2025_01 PARTITION OF DeliveryLog
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

CREATE TABLE DeliveryLog_2025_02 PARTITION OF DeliveryLog
FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');
```

---

### 2. API ë¶€í•˜

#### ì‹¤ì‹œê°„ GPS ì¶”ì 

**ì‹œë‚˜ë¦¬ì˜¤:**
- ë°°ì†¡ê¸°ì‚¬ 20ëª…
- GPS ì—…ë°ì´íŠ¸ ì£¼ê¸°: 30ì´ˆ

**API í˜¸ì¶œëŸ‰:**
```
20ëª… Ã— 2íšŒ/ë¶„ = 40 req/min = 2,400 req/hour
```

**ëŒ€ì—­í­:**
```
GPS ë°ì´í„° í¬ê¸°: ~100 bytes
40 req/min Ã— 100 bytes = 4KB/min = 240KB/hour = 2MB/day
```

**ê²°ë¡ :** ë§¤ìš° ë‚®ì€ ë¶€í•˜ (ë¬´ì‹œ ê°€ëŠ¥)

---

#### Kakao Mobility API í˜¸ì¶œ

**ì‹œë‚˜ë¦¬ì˜¤:**
- ì½”ìŠ¤ ì‹œë®¬ë ˆì´ì…˜: ê´€ë¦¬ìê°€ í•˜ë£¨ 10íšŒ
- ê° ì‹œë®¬ë ˆì´ì…˜ë‹¹ API í˜¸ì¶œ: 25íšŒ (ì‚¬ì—…ì¥ 25ê°œ)

**API í˜¸ì¶œëŸ‰:**
```
10íšŒ Ã— 25 = 250 req/day
```

**Kakao API ë¬´ë£Œ í•œë„:**
- ì›” 100,000ê±´

**ê²°ë¡ :** ë¬´ë£Œ í•œë„ ë‚´ ì¶©ë¶„

---

### 3. ëª¨ë°”ì¼ ì•± ë°°í„°ë¦¬ ì†Œëª¨

#### ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì 

**ì„¤ì •:**
- ì—…ë°ì´íŠ¸ ì£¼ê¸°: 30ì´ˆ
- ì •í™•ë„: High

**ì˜ˆìƒ ë°°í„°ë¦¬ ì†Œëª¨:**
- 8ì‹œê°„ ë°°ì†¡: ~15-20% (ì¤‘ê°„ ìˆ˜ì¤€)

**ìµœì í™” ë°©ì•ˆ:**
- ë°°ì†¡ ì‹œì‘/ì¢…ë£Œ ë²„íŠ¼ìœ¼ë¡œ ì¶”ì  on/off
- ì •ì§€ ì‹œ ìœ„ì¹˜ ì¶”ì  ì¤‘ë‹¨
- ê±°ë¦¬ ê¸°ë°˜ ì—…ë°ì´íŠ¸ ì‚¬ìš© (100m)

---

### 4. ì„œë²„ ë¦¬ì†ŒìŠ¤

#### CPU

**ì£¼ìš” ì‘ì—…:**
- GPS ë°ì´í„° ì²˜ë¦¬
- ê±°ë¦¬/ì‹œê°„ ê³„ì‚°
- ê²½ë¡œ ìµœì í™” ì•Œê³ ë¦¬ì¦˜

**ì˜ˆìƒ ì‚¬ìš©ëŸ‰:**
- í‰ê· : 5-10%
- í”¼í¬: 20-30% (ê²½ë¡œ ìµœì í™” ì‹œ)

#### ë©”ëª¨ë¦¬

**ì˜ˆìƒ ì‚¬ìš©ëŸ‰:**
- DeliveryLog ìºì‹±: ~50MB (ìµœê·¼ 7ì¼)
- Route ì •ë³´: ~10MB
- ì´: ~100MB ì¶”ê°€

#### ë„¤íŠ¸ì›Œí¬

**ì¼ì¼ íŠ¸ë˜í”½:**
- GPS ì—…ë°ì´íŠ¸: 2MB
- API ì‘ë‹µ: 50MB
- ì´: ~60MB/day = 1.8GB/month

**ê²°ë¡ :** í˜„ì¬ ì„œë²„(e2-small) ì¶©ë¶„

---

## ğŸ’° ë¹„ìš© ë¶„ì„

### 1. API ë¹„ìš©

| í•­ëª© | ì‚¬ìš©ëŸ‰ | ë¹„ìš© |
|------|--------|------|
| **Kakao Mobility API** | ì›” 7,500ê±´ | ë¬´ë£Œ (100,000ê±´ í•œë„) |
| **GPS ë°ì´í„° ì „ì†¡** | ì›” 1.8GB | í¬í•¨ (GCP VM íŠ¸ë˜í”½) |

**ì´ ì¶”ê°€ ë¹„ìš©:** $0

---

### 2. ê°œë°œ ë¹„ìš©

| í•­ëª© | ì˜ˆìƒ ê³µìˆ˜ | ì„¤ëª… |
|------|----------|------|
| **DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€** | 1ì¼ | Prisma ëª¨ë¸ 4ê°œ ì¶”ê°€ |
| **ë°±ì—”ë“œ API** | 5ì¼ | CRUD + ì‹œë®¬ë ˆì´ì…˜ + GPS ì²˜ë¦¬ |
| **ì›¹ ê´€ë¦¬ì** | 7ì¼ | ì½”ìŠ¤ ê´€ë¦¬ í˜ì´ì§€ 3ê°œ |
| **ëª¨ë°”ì¼ ì•±** | 10ì¼ | GPS ì¶”ì  + ë°°ì†¡ í™”ë©´ 4ê°œ |
| **í…ŒìŠ¤íŠ¸ ë° ë²„ê·¸ ìˆ˜ì •** | 3ì¼ | í†µí•© í…ŒìŠ¤íŠ¸ |
| **ì´ ê°œë°œ ê¸°ê°„** | **26ì¼** (ì•½ 1ê°œì›”) | |

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ì œì•½

### 1. GPS ì •í™•ë„

**ë¬¸ì œ:**
- ì‹¤ë‚´/ì§€í•˜: GPS ì •í™•ë„ ì €í•˜
- ê³ ì¸µ ë¹Œë”©: ì‹ í˜¸ ë°˜ì‚¬

**í•´ê²°:**
- Wi-Fi/ì…€ë£°ëŸ¬ ìœ„ì¹˜ ë³´ì¡°
- ìˆ˜ë™ ì²´í¬ì¸ ì˜µì…˜ ì œê³µ

---

### 2. ë°°í„°ë¦¬ ì†Œëª¨

**ë¬¸ì œ:**
- ë°±ê·¸ë¼ìš´ë“œ GPS ì¶”ì  ì‹œ ë°°í„°ë¦¬ ì†Œëª¨

**í•´ê²°:**
- ë°°ì†¡ ì‹œì‘/ì¢…ë£Œ ëª…í™•íˆ
- ì›€ì§ì„ ê°ì§€ í›„ ì¶”ì  í™œì„±í™”
- ì •ì§€ ì‹œ ì¶”ì  ì¼ì‹œ ì¤‘ì§€

---

### 3. ë„¤íŠ¸ì›Œí¬ ì—°ê²°

**ë¬¸ì œ:**
- ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ë°ì´í„° ì „ì†¡ ë¶ˆê°€

**í•´ê²°:**
- ë¡œì»¬ DBì— ë°ì´í„° ì €ì¥ (SQLite)
- ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™”

---

### 4. ê°œì¸ì •ë³´ ë³´í˜¸

**ë¬¸ì œ:**
- ê¸°ì‚¬ ìœ„ì¹˜ ì¶”ì  â†’ ê°œì¸ì •ë³´ ì´ìŠˆ

**í•´ê²°:**
- ë°°ì†¡ ì‹œê°„ì—ë§Œ ì¶”ì 
- ëª…í™•í•œ ë™ì˜ ì ˆì°¨
- ìœ„ì¹˜ ë°ì´í„° ì•”í˜¸í™” ì €ì¥
- 30ì¼ í›„ ìë™ ì‚­ì œ

---

## ğŸ¯ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: ê¸°ë³¸ ì½”ìŠ¤ ê´€ë¦¬ (2ì£¼)

- [ ] DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€
- [ ] ì½”ìŠ¤ CRUD API
- [ ] ì›¹ ê´€ë¦¬ì: ì½”ìŠ¤ ëª©ë¡/ìƒì„±/ìˆ˜ì •
- [ ] ì‚¬ì—…ì¥ ë°°ì • ë° ìˆœì„œ ê´€ë¦¬

### Phase 2: ëª¨ë°”ì¼ ë°°ì†¡ ê¸°ëŠ¥ (2ì£¼)

- [ ] ëª¨ë°”ì¼: ì˜¤ëŠ˜ì˜ ì½”ìŠ¤ ì¡°íšŒ
- [ ] ìˆ˜ë™ ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ
- [ ] ë°°ì†¡ ê¸°ë¡ ì €ì¥
- [ ] ê´€ë¦¬ì: ë°°ì†¡ ê¸°ë¡ ì¡°íšŒ

### Phase 3: GPS ìë™ ì¶”ì  (1ì£¼)

- [ ] ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì 
- [ ] Geofencing ìë™ ì²´í¬ì¸
- [ ] ì‹¤ì‹œê°„ ìœ„ì¹˜ ëª¨ë‹ˆí„°ë§ (ê´€ë¦¬ì)

### Phase 4: ê²½ë¡œ ìµœì í™” (1ì£¼)

- [ ] Kakao Mobility API ì—°ë™
- [ ] ê²½ë¡œ ì‹œë®¬ë ˆì´ì…˜
- [ ] ìµœì  ê²½ë¡œ ì œì•ˆ

---

## ğŸ“ ê²°ë¡ 

### âœ… êµ¬í˜„ ê°€ëŠ¥

**ì´ìœ :**
1. **ê¸°ì¡´ ì¸í”„ë¼ í™œìš© ê°€ëŠ¥**
   - GPS ì¢Œí‘œ (latitude, longitude)
   - DELIVERY_DRIVER ì—­í• 
   - Attendance GPS ë¡œì§ ì¬ì‚¬ìš©

2. **ì™¸ë¶€ API í™œìš© ê°€ëŠ¥**
   - Kakao Mobility API (ë¬´ë£Œ)
   - Expo Location (React Native)

3. **ì‹œìŠ¤í…œ ë¶€í•˜ ë‚®ìŒ**
   - ì¶”ê°€ ì„œë²„ ë¶ˆí•„ìš”
   - í˜„ì¬ e2-small VM ì¶©ë¶„
   - ë¬´ë£Œ API í•œë„ ë‚´

4. **ê°œë°œ ê¸°ê°„ ì ì •**
   - 1ê°œì›” ë‚´ ì™„ì„± ê°€ëŠ¥
   - ë‹¨ê³„ë³„ ë°°í¬ ê°€ëŠ¥

### ğŸ’¡ ê¶Œì¥ì‚¬í•­

1. **Phase 1ë¶€í„° ìˆœì°¨ ê°œë°œ**
   - ê¸°ë³¸ ì½”ìŠ¤ ê´€ë¦¬ ë¨¼ì € êµ¬í˜„
   - ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘
   - ì ì§„ì  ê¸°ëŠ¥ ì¶”ê°€

2. **MVP (ìµœì†Œ ê¸°ëŠ¥ ì œí’ˆ) ë¨¼ì €**
   - ìˆ˜ë™ ì²´í¬ì¸ë§Œìœ¼ë¡œ ì‹œì‘
   - GPS ìë™ ì¶”ì ì€ ë‚˜ì¤‘ì— ì¶”ê°€

3. **ì‹¤ì‚¬ìš© ë°ì´í„° ìˆ˜ì§‘**
   - ì‹¤ì œ ë°°ì†¡ ê¸°ë¡ ë¶„ì„
   - ê²½ë¡œ ìµœì í™” ê°œì„ 

### ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **ìš”êµ¬ì‚¬í•­ ìµœì¢… í™•ì¸**
   - ìš°ì„ ìˆœìœ„ ê²°ì •
   - MVP ë²”ìœ„ ì •ì˜

2. **DB ìŠ¤í‚¤ë§ˆ ìŠ¹ì¸**
   - Prisma ëª¨ë¸ ê²€í† 
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

3. **ê°œë°œ ì‹œì‘**
   - Phase 1 ì°©ìˆ˜

---

**ì‘ì„±ì:** Claude Code Assistant
**ê²€í†  ì™„ë£Œì¼:** 2025-10-18
