# Work Log - 2025-11-11

## ì‘ì—… ê°œìš”
CONSIGNMENTë¥¼ ë…ë¦½ Divisionìœ¼ë¡œ ë¶„ë¦¬, ì‚¬ì—…ì¥ ê·¸ë£¹ ê³„ì¸µ êµ¬ì¡° ê°œì„ 

## ì™„ë£Œëœ ì‘ì—…

### 1. CONSIGNMENT Division ì¶”ê°€ âœ…

**ëª©ì **: ìœ„íƒì‚¬ì—…ì¥ì„ ë³¸ì‚¬/ì˜ë‚¨ì§€ì‚¬ì™€ ë™ë“±í•œ ë…ë¦½ divisionìœ¼ë¡œ ë¶„ë¦¬

#### Database Schema ë³€ê²½
**íŒŒì¼**: `backend/prisma/schema.prisma:497-501`

```prisma
enum Division {
  HQ
  YEONGNAM
  CONSIGNMENT  // ì¶”ê°€
}
```

#### ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
- **ë°±ì—… ìƒì„±**: `backup/daham_voc_backup_before_consignment_20251111_184553.dump` (368KB)
- **SiteGroup**: "ìœ„íƒì‚¬ì—…ì¥" division HQ â†’ CONSIGNMENT (1ê°œ)
- **Site**: CONSIGNMENT íƒ€ì… ì‚¬ì—…ì¥ division HQ â†’ CONSIGNMENT (11ê°œ)

```bash
# ì‹¤í–‰í•œ SQL
UPDATE "SiteGroup" SET division = 'CONSIGNMENT' WHERE name = 'ìœ„íƒì‚¬ì—…ì¥';
UPDATE "Site" SET division = 'CONSIGNMENT' WHERE type = 'CONSIGNMENT';
```

---

### 2. ê³„ì¸µ êµ¬ì¡° ìˆ˜ì • âœ…

#### Before
```
ë‹¤í•¨í‘¸ë“œ
â”œâ”€â”€ ë³¸ì‚¬ (HQ)
â”‚   â”œâ”€â”€ ë„ì‹œë½
â”‚   â”œâ”€â”€ ìš´ë°˜
â”‚   â”œâ”€â”€ ìš”ì–‘ì›
â”‚   â”œâ”€â”€ í•™êµ
â”‚   â””â”€â”€ ìœ„íƒì‚¬ì—…ì¥ â† HQ í•˜ìœ„
â””â”€â”€ ì˜ë‚¨ì§€ì‚¬ (YEONGNAM)
```

#### After
```
ë‹¤í•¨í‘¸ë“œ
â”œâ”€â”€ ë³¸ì‚¬ (HQ)
â”‚   â”œâ”€â”€ ë„ì‹œë½
â”‚   â”œâ”€â”€ ìš´ë°˜
â”‚   â”œâ”€â”€ ìš”ì–‘ì›
â”‚   â””â”€â”€ í•™êµ
â”œâ”€â”€ ì˜ë‚¨ì§€ì‚¬ (YEONGNAM)
â”‚   â”œâ”€â”€ ì˜ë‚¨ë„ì‹œë½
â”‚   â”œâ”€â”€ ì˜ë‚¨ìš´ë°˜
â”‚   â””â”€â”€ ì˜ë‚¨ìš”ì–‘ì›
â””â”€â”€ ìœ„íƒì‚¬ì—…ì¥ (CONSIGNMENT) â† ë…ë¦½ division
    â””â”€â”€ ìœ„íƒì‚¬ì—…ì¥ (11ê°œ ì‚¬ì—…ì¥)
```

---

### 3. Backend ì½”ë“œ ìˆ˜ì • âœ…

**íŒŒì¼**: `backend/src/services/site-group.service.ts:63-113`

```typescript
const hierarchy = {
  company: 'ë‹¤í•¨í‘¸ë“œ',
  divisions: [
    { code: 'HQ', name: 'ë³¸ì‚¬', groups: [...] },
    { code: 'YEONGNAM', name: 'ì˜ë‚¨ì§€ì‚¬', groups: [...] },
    { code: 'CONSIGNMENT', name: 'ìœ„íƒì‚¬ì—…ì¥', groups: [...] }, // ì¶”ê°€
  ],
};
```

---

### 4. Frontend ì½”ë“œ ìˆ˜ì • âœ…

#### íƒ€ì… ì •ì˜
**íŒŒì¼**: `web/src/types/index.ts`

```typescript
// Division íƒ€ì… í™•ì¥
export type Division = 'HQ' | 'YEONGNAM' | 'CONSIGNMENT';

export const DivisionLabels: Record<Division, string> = {
  HQ: 'ë³¸ì‚¬',
  YEONGNAM: 'ì˜ë‚¨ì§€ì‚¬',
  CONSIGNMENT: 'ìœ„íƒì‚¬ì—…ì¥',
};
```

#### SiteGroupPage ìˆ˜ì •
**íŒŒì¼**: `web/src/pages/site/SiteGroupPage.tsx`

- CONSIGNMENT division íƒ€ì… ì¶”ê°€
- Modal ì œëª©ì— ìœ„íƒì‚¬ì—…ì¥ ë ˆì´ë¸” ì¶”ê°€
- ëª¨ë“  division ë™ì¼í•˜ê²Œ ì²˜ë¦¬

#### SiteFormPage ìˆ˜ì •
**íŒŒì¼**: `web/src/pages/site/SiteFormPage.tsx:192`

```typescript
// Before
label: `${group.name} (${group.division === 'HQ' ? 'ë³¸ì‚¬' : 'ì˜ë‚¨ì§€ì‚¬'})`

// After
label: `${group.name} (${DivisionLabels[group.division]})`
```

**ìˆ˜ì • ì´ìœ **: "ìœ„íƒì‚¬ì—…ì¥ (ì˜ë‚¨ì§€ì‚¬)" â†’ "ìœ„íƒì‚¬ì—…ì¥ (ìœ„íƒì‚¬ì—…ì¥)" ì •ìƒ í‘œì‹œ

---

### 5. ë°°í¬ ë¬¸ì„œ ê°œì„  âœ…

**íŒŒì¼**: `DEPLOYMENT.md`

#### ì¶”ê°€ëœ ë‚´ìš©: ë¹ ë¥¸ ë°°í¬ ëª…ë ¹ì–´

```bash
# ì „ì²´ ë°°í¬ (Backend + Frontend)
cd ~/daham_voc && git pull origin main && cd backend && npm install && npx prisma generate && npm run build && cd ../web && npm install && npm run build && cd .. && pm2 restart ecosystem.config.js && pm2 save

# Backendë§Œ ë°°í¬
cd ~/daham_voc && git pull origin main && cd backend && npm install && npx prisma generate && npm run build && cd .. && pm2 restart daham-voc-api && pm2 save

# Frontendë§Œ ë°°í¬
cd ~/daham_voc && git pull origin main && cd web && npm install && npm run build && cd .. && pm2 restart daham-web && pm2 save
```

---

### 6. Nginx Timeout ì„¤ì • ê°œì„  ê¶Œê³  ğŸ“

**ë¬¸ì œ**: ì²« ì ‘ì† ì‹œ 502/504 ì—ëŸ¬ ë°œìƒ

**ì›ì¸**: Backend Cold Start ì‹œê°„ì´ ê¸°ë³¸ timeout(60ì´ˆ)ë³´ë‹¤ ê¸¸ì–´ì„œ ë°œìƒ

**í•´ê²° ë°©ì•ˆ**:
**íŒŒì¼**: `/etc/nginx/sites-available/dahamvoc`

```nginx
# API Serverì™€ Admin Server ëª¨ë‘ì— ì¶”ê°€
location / {
    # ... ê¸°ì¡´ ì„¤ì • ...

    # Timeout ì„¤ì • ì¶”ê°€
    proxy_connect_timeout 300;
    proxy_send_timeout 300;
    proxy_read_timeout 300;
}
```

**ì ìš© ë°©ë²•**:
```bash
sudo nano /etc/nginx/sites-available/dahamvoc
# ìœ„ ì„¤ì • ì¶”ê°€
sudo nginx -t
sudo systemctl reload nginx
```

---

### 7. ê¸°íƒ€ ê°œì„  âœ…

#### .gitignore ì—…ë°ì´íŠ¸
**íŒŒì¼**: `.gitignore`

```gitignore
# Database Backups
backup/
*.dump
```

**ì´ìœ **: ë°±ì—… íŒŒì¼ì€ ë¯¼ê°í•œ ë°ì´í„° í¬í•¨, ìš©ëŸ‰ì´ ì»¤ì„œ Gitì—ì„œ ì œì™¸

---

## ë°°í¬ ê²°ê³¼

### PM2 ìƒíƒœ
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 12 â”‚ daham-voc-api      â”‚ cluster  â”‚ 10   â”‚ online    â”‚ 0%       â”‚ 112.3mb  â”‚
â”‚ 17 â”‚ daham-web          â”‚ fork     â”‚ 2    â”‚ online    â”‚ 0%       â”‚ 45.9mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ URL
- Backend: https://api.dahamvoc.co.kr
- Frontend: https://admin.dahamvoc.co.kr

### í™•ì¸ ì™„ë£Œ
- âœ… ì‚¬ì—…ì¥ ê´€ë¦¬ í˜ì´ì§€: ìœ„íƒì‚¬ì—…ì¥ ë…ë¦½ divisionìœ¼ë¡œ í‘œì‹œ
- âœ… ì‚¬ì—…ì¥ ìƒì„± í˜ì´ì§€: "ìœ„íƒì‚¬ì—…ì¥ (ìœ„íƒì‚¬ì—…ì¥)" ì •ìƒ í‘œì‹œ
- âœ… ê¶Œí•œ ì‹œìŠ¤í…œ: ìœ„íƒì‚¬ì—…ì¥ ê·¸ë£¹ ë°°ì • ì •ìƒ ì‘ë™

---

## Git ì»¤ë°‹ ë‚´ì—­

```
eb8441d - chore: backup í´ë”ë¥¼ gitignoreì— ì¶”ê°€
7f9b1fc - docs: í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë¹ ë¥¸ ë°°í¬ ëª…ë ¹ì–´ ì¶”ê°€
88113c5 - fix: ì‚¬ì—…ì¥ ê·¸ë£¹ ì„ íƒ ì‹œ CONSIGNMENT division ë ˆì´ë¸” í‘œì‹œ
30b28d8 - fix: GitHub Actionsì—ì„œ mobile ì„œë¸Œëª¨ë“ˆ ì²´í¬ì•„ì›ƒ ì œê±°
2d08390 - feat: CONSIGNMENTë¥¼ ë…ë¦½ divisionìœ¼ë¡œ ë¶„ë¦¬
7d725da - refactor: ìœ„íƒì‚¬ì—…ì¥ ê·¸ë£¹ì„ ì¼ë°˜ ê·¸ë£¹ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…

**ìœ„ì¹˜**: `C:\Users\js\Desktop\dev\daham_voc\backup\`

```
backup/
â”œâ”€â”€ daham_voc_backup_before_consignment_20251111_184553.dump (368KB) â† ì˜¤ëŠ˜ ì‘ì—… ì „
â””â”€â”€ daham_voc_backup_20251022_205721.dump (325KB) â† ì´ì „ ë°±ì—…
```

**ë³µì› ë°©ë²•** (í•„ìš” ì‹œ):
```bash
pg_restore -h aws-1-ap-northeast-2.pooler.supabase.com -p 5432 -U postgres.iyussgoqhgzogjvpuxnb -d postgres --clean backup/daham_voc_backup_before_consignment_20251111_184553.dump
```

---

## êµí›ˆ

### 1. Division vs Type êµ¬ë¶„ ëª…í™•íˆ
- **Division**: ì¡°ì§ êµ¬ì¡° (ë³¸ì‚¬, ì˜ë‚¨, ìœ„íƒ)
- **Type**: ì‚¬ì—…ì¥ ìœ í˜• (ìœ„íƒ, ìš´ë°˜, ë„ì‹œë½, í–‰ì‚¬)
- ì´ˆê¸°ì—ëŠ” ìœ„íƒì‚¬ì—…ì¥ì„ ë³¸ì‚¬ í•˜ìœ„ë¡œ ì˜ëª» ì„¤ê³„í–ˆìœ¼ë‚˜ ìˆ˜ì • ì™„ë£Œ

### 2. ë°±ì—”ë“œ Cold Start ìµœì í™” í•„ìš”
- Prisma Client ì´ˆê¸°í™” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼
- Redis ìºì‹± ë¯¸ì‚¬ìš© (`âš ï¸ Redis URL not configured`)
- Nginx timeout ì„¤ì •ìœ¼ë¡œ ì„ì‹œ í•´ê²°, ê·¼ë³¸ í•´ê²°ì€ Redis ë„ì… ê³ ë ¤

### 3. ë°°í¬ í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œí™” ì¤‘ìš”
- GitHub Actions ì„¤ì • ì—†ì´ ìˆ˜ë™ ë°°í¬ ì§„í–‰
- ì›ë¼ì´ë„ˆ ë°°í¬ ëª…ë ¹ì–´ë¡œ íš¨ìœ¨ì„± ê°œì„ 
- í–¥í›„ GitHub Secrets ì„¤ì • ì‹œ ìë™ ë°°í¬ ê°€ëŠ¥

---

## ê¸°ìˆ  ìŠ¤íƒ

### Backend
- Prisma ORM + PostgreSQL (Supabase)
- Node.js + Express
- PM2 (Process Manager)

### Web Frontend
- React + TypeScript + Vite
- Ant Design (Tree, Select ì»´í¬ë„ŒíŠ¸)
- React Query

### Infrastructure
- GCP VM (Compute Engine)
- Nginx (Reverse Proxy)
- Supabase (PostgreSQL í˜¸ìŠ¤íŒ…)

---

## ë‹¤ìŒ ì‘ì—… ê³„íš

### ì„±ëŠ¥ ìµœì í™”
1. Redis ìºì‹± ë„ì… (Backend Cold Start ê°œì„ )
2. Nginx timeout ì„¤ì • ì ìš©
3. Frontend ë²ˆë“¤ í¬ê¸° ìµœì í™” (í˜„ì¬ 2.2MB)

### ìë™ ë°°í¬
1. GitHub Secrets ì„¤ì • (SSH í‚¤ ë“±)
2. GitHub Actions ìë™ ë°°í¬ í™œì„±í™”
3. ë°°í¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼ ì„¤ì •

### ê¶Œí•œ ì‹œìŠ¤í…œ
1. ìœ„íƒì‚¬ì—…ì¥ ì „ìš© ê´€ë¦¬ì ì—­í•  ì¶”ê°€ ê°€ëŠ¥ì„± ê²€í† 
2. Division ê¸°ë°˜ ê¶Œí•œ í•„í„°ë§ ê²€ì¦

---

**ì‘ì„±ì¼**: 2025-11-11
**ì‘ì„±ì**: Claude Code
**ì„¸ì…˜ ìƒíƒœ**: ì™„ë£Œ
**ì£¼ìš” ì„±ê³¼**: CONSIGNMENT Division ë¶„ë¦¬ + ë°°í¬ í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œí™”
