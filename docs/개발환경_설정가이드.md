# 개발 환경 설정 가이드

> 집과 사무실에서 동일한 데이터로 개발하기 위한 Supabase 설정 가이드

## 목차
- [개요](#개요)
- [Supabase 프로젝트 생성](#supabase-프로젝트-생성)
- [데이터베이스 연결 설정](#데이터베이스-연결-설정)
- [Prisma 마이그레이션 실행](#prisma-마이그레이션-실행)
- [개발 서버 실행](#개발-서버-실행)
- [문제 해결](#문제-해결)

---

## 개요

### 왜 Supabase를 사용하나요?

- **집/사무실 데이터 동기화**: 어디서든 동일한 개발용 데이터로 작업
- **무료 제공**: 개발 환경으로 충분한 용량 제공
- **PostgreSQL 완전 호환**: 배포 환경과 동일한 DB 엔진 사용
- **자동 백업**: 클라우드에서 자동 관리

### 환경 구분

| 환경 | 데이터베이스 | 용도 |
|------|------------|------|
| **개발** | Supabase PostgreSQL | 로컬 개발, 테스트 (집/사무실 공유) |
| **배포** | GCP Cloud SQL | 실제 서비스 운영 |

---

## Supabase 프로젝트 생성

### 1. Supabase 계정 생성

1. [https://supabase.com](https://supabase.com) 접속
2. "Start your project" 클릭
3. GitHub 계정으로 로그인 (권장)

### 2. 새 프로젝트 생성

1. Dashboard에서 "New Project" 클릭
2. 프로젝트 정보 입력:
   - **Name**: `daham-voc-dev` (또는 원하는 이름)
   - **Database Password**: 안전한 비밀번호 설정 (⚠️ 꼭 저장!)
   - **Region**: `Northeast Asia (Seoul)` 선택
   - **Pricing Plan**: Free 선택

3. "Create new project" 클릭 (생성까지 2-3분 소요)

### 3. 연결 정보 확인

프로젝트 생성 후:

1. 좌측 메뉴에서 **Settings** (⚙️) 클릭
2. **Database** 클릭
3. **Connection string** 섹션에서 **URI** 복사

연결 문자열 형식:
```
postgresql://postgres.[프로젝트ID]:[비밀번호]@aws-0-ap-northeast-2.pooler.supabase.com:6543/postgres
```

**예시:**
```
postgresql://postgres.abcdefghijk:MySecretPassword123@aws-0-ap-northeast-2.pooler.supabase.com:6543/postgres
```

---

## 데이터베이스 연결 설정

### 1. `.env` 파일 수정

`backend/.env` 파일을 열고 `DATABASE_URL`을 Supabase 연결 문자열로 변경:

```bash
# Before (로컬 PostgreSQL)
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/daham_voc

# After (Supabase)
DATABASE_URL=postgresql://postgres.abcdefghijk:MySecretPassword123@aws-0-ap-northeast-2.pooler.supabase.com:6543/postgres
```

### 2. 연결 테스트

터미널에서 다음 명령어로 연결 확인:

```bash
cd backend
npx prisma db pull
```

성공 메시지가 나오면 연결 완료!

---

## Prisma 마이그레이션 실행

### 1. 스키마 초기화

```bash
cd backend
npx prisma migrate deploy
```

또는 개발 환경에서:

```bash
npx prisma migrate dev
```

### 2. Prisma 클라이언트 생성

```bash
npx prisma generate
```

### 3. 데이터베이스 확인

Supabase Dashboard에서 테이블 생성 확인:

1. Dashboard → **Table Editor** 클릭
2. 생성된 테이블 목록 확인 (User, Site, Staff 등)

---

## 개발 서버 실행

### 1. 패키지 설치 (최초 1회)

루트 디렉토리에서:

```bash
npm install
```

### 2. 백엔드 서버 실행

```bash
cd backend
npm run dev
```

서버가 정상 실행되면:
```
✅ PostgreSQL connected successfully
🚀 Server running on http://localhost:3000
```

### 3. 웹 프론트엔드 실행

새 터미널에서:

```bash
cd web
npm run dev
```

브라우저에서 http://localhost:5173 접속

---

## 문제 해결

### Q1: "PostgreSQL connection failed" 에러

**원인**: DATABASE_URL이 잘못되었거나 Supabase 프로젝트가 비활성화됨

**해결방법**:
1. `.env` 파일의 `DATABASE_URL` 재확인
2. Supabase Dashboard에서 프로젝트 상태 확인
3. 비밀번호가 정확한지 확인 (특수문자는 URL 인코딩 필요)

### Q2: "Prisma Client does not exist" 에러

**원인**: Prisma 클라이언트가 생성되지 않음

**해결방법**:
```bash
cd backend
npx prisma generate
```

### Q3: 테이블이 생성되지 않음

**원인**: 마이그레이션이 실행되지 않음

**해결방법**:
```bash
cd backend
npx prisma migrate deploy
```

또는:
```bash
npx prisma db push
```

### Q4: Supabase 무료 플랜 제한

**제한사항**:
- 프로젝트: 2개
- 용량: 500MB
- 동시 연결: 60개

**해결방법**:
- 개발용으로는 충분함
- 필요시 기존 테스트 프로젝트 삭제 후 재생성

---

## 집/사무실 환경 전환

### 집에서 작업 시작

1. GitHub에서 최신 코드 풀
   ```bash
   git pull origin main
   git submodule update --init --recursive
   ```

2. `.env` 파일 확인 (Supabase URL로 설정되어 있는지)

3. 서버 실행
   ```bash
   cd backend && npm run dev
   cd web && npm run dev
   ```

### 사무실에서 작업 시작

동일한 과정 반복! Supabase 덕분에 데이터는 자동으로 동기화됩니다.

---

## 배포 환경 전환

배포 시에는 운영 DB로 자동 전환되도록 환경변수를 설정하면 됩니다:

```bash
# 배포 환경 (GCP Cloud Run 등)
DATABASE_URL=postgresql://[운영DB연결문자열]
NODE_ENV=production
```

---

## 추가 리소스

- [Supabase 공식 문서](https://supabase.com/docs)
- [Prisma 마이그레이션 가이드](https://www.prisma.io/docs/concepts/components/prisma-migrate)
- [프로젝트 README](../README.md)

---

## 요약 체크리스트

개발 환경 설정 완료 체크:

- [ ] Supabase 프로젝트 생성
- [ ] 연결 문자열 복사
- [ ] `backend/.env` 파일 수정
- [ ] `npx prisma migrate deploy` 실행
- [ ] `npx prisma generate` 실행
- [ ] 백엔드 서버 실행 확인
- [ ] 웹 서버 실행 확인
- [ ] Supabase Table Editor에서 테이블 확인

모든 항목이 체크되었다면 개발 준비 완료! 🎉
